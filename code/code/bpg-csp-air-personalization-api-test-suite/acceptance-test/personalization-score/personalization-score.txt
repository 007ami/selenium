*** Settings ***
Force Tags        functional    regression
Resource          ../../resources/imports.txt
Resource          resources/personalization-score.txt
Resource          ../resources/common.txt
Resource          ../admin-upload/resources/admin-upload.txt
Resource          ../admin-features/resources/admin-features.txt

*** Test Cases ***
FNC_008 Score Is Successfully Retrieved With Multiple AP, CP And Boost Data With Multiple Match
    [Documentation]    Request: Airport-Airport
    ...
    ...    *Scenario* : Multiple AP and CP Matching and Non Matching Data
    ...
    ...    >> For AP Same rowId and policyOrder
    ...
    ...    >> For CP Different Policy Order
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Variables For Personalization Score    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT    dep_date=20181208
    ...    app_id=Desktop_Amadeus
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    # Multiple Matching AP Data
    Generate Test Data For Agency Preferences From File    file=FNC_008_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_008_cp_data.csv
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=Desktop_Amadeus    boost_ap=0.7    boost_cp=1
    # Different Boost Consumer
    Generate Test Variables And Data For Boost    boost_version=v0    boost_app_id=MyCWT_Mobile    boost_ap=0.1    boost_cp=0.9
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_008_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_008_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_008_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_008_v3_results.json

FNC_021 Score Is Succesfully Retrieved With Multiple Matching Where Destination Code Type Is City
    [Documentation]    Request: Destination code type is City
    ...
    ...    Scenario : Multiple Distinct And Non Matching AP and CP Airport To Airpot Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    csu_guid=C:1234    iss_country=JP    origin=OKO    destination=SFY    dep_date=20181212    app_id=MyCWT_Mobile
    ...    origin_code_type=A    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    # Multiple Matching AP Data
    Generate Test Data For Agency Preferences From File    file=FNC_021_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_021_cp_data.csv
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.6    boost_cp=0.5
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_021_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_021_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_021_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_021_v3_results.json

FNC_022 Score Is Succesfully Retrieved With Multiple Matching Where Origin Code Type Is City
    [Documentation]    Request : Origin code type is City
    ...
    ...    Scenario : Multiple Distinct And Non Matching AP and CP Airport To Airpot Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    csu_guid=C:1234    iss_country=JP    origin=TYO    destination=CEF    dep_date=20181212    app_id=MyCWT_Mobile
    ...    origin_code_type=C    destination_code_type=A
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    # Multiple Matching AP Data
    Generate Test Data For Agency Preferences From File    file=FNC_022_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_022_cp_data.csv
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.5    boost_cp=1
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_022_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_022_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_022_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_022_v3_results.json

FNC_023 Score Is Succesfully Retrieved With Multiple Matching Where Origin-Destination Code Type Is City
    [Documentation]    Request: Origin and Destinatin code type is City
    ...
    ...    Scenario : Multiple Distinct And Non Matching AP and CP Airport To Airpot Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    trv_guid=S:0986    csu_guid=C:1234    iss_country=JP    origin=TYO    destination=SFY    dep_date=20181212
    ...    app_id=MyCWT_Mobile    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    # Multiple Matching AP Data
    Generate Test Data For Agency Preferences From File    file=FNC_023_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_023_cp_data.csv
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.7    boost_cp=0.4
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_023_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_023_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_023_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_023_v3_results.json

FNC_024 Score Is Succesfully Retrieved With Multiple Matching Where Origin-Destination Code Type Is City (City Code Match)
    [Documentation]    Request: Origin and Destinatin code type is City
    ...
    ...    Scenario :
    ...    \ \ \ \ >> Matching CP Data City To City
    ...
    ...    \ \ >> Multiple Non Matching CP Data Airport To Airpot
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    csu_guid=C:1234    iss_country=US    origin=TYO    destination=SFY    dep_date=20181212    app_id=MyCWT_Mobile
    ...    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    # CP Data Using City Code
    Generate Test Data For Client Preferences From File    file=FNC_024_cp_data.csv
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.7    boost_cp=1
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_024_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_024_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_024_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_024_v3_results.json

FNC_025 Score Is Succesfully Retrieved With Multiple Matching Where Origin-Destination Code Type Is City (With Hierarchy)
    [Documentation]    Request: Origin and Destinatin code type is City
    ...
    ...    Scenario :
    ...
    ...    >> Multiple Matching AP Data WIth All Hierarchy
    ...
    ...    >> Multiple Matching CP Data WIth All Hierarchy
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    csu_guid=C:1234    iss_country=JP    origin=TYO    destination=SFY    dep_date=20181212    app_id=MyCWT_Mobile
    ...    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    #Agent Data
    Generate Test Data For Agency Preferences From File    file=FNC_025_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_025_cp_data.csv
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.7    boost_cp=1
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_025_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_025_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_025_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_025_v3_results.json

FNC_026 Score Is Succesfully Retrieved With Multiple Matching With AP (Outbound, Lower Boundary) , CP (Inbound, Upper Boundary) For Departure Date
    [Documentation]    Scenario :
    ...
    ...    >> Multiple Matching AP Data Outbound and Lowerbound Departure Date
    ...
    ...    >> Multiple Matching CP Data Inbound and upperbound Departure Date
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Generate Test Variables For Personalization Score    dep_date=20181208    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    # OutBound AP Dep Date
    Generate Test Data For Agency Preferences From File    file=FNC_026_ap_data.csv
    #InBound CP Dep Date
    Generate Test Data For Client Preferences From File    file=FNC_026_cp_data.csv
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.1    boost_cp=1
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_026_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_026_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_026_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_026_v3_results.json

FNC_027 Score Is Succesfully Retrieved With Multiple Matching With AP (Inbound, Upper Boundary) , CP (Outbound, Lower Boundary) For Departure Date
    [Documentation]    Scenario :
    ...
    ...    >> Multiple Matching AP Data nbound and upperbound Departure Date
    ...
    ...    >> Multiple Matching CP Data \ Outbound and Lowerbound Departure Date
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    V1::*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Generate Test Variables For Personalization Score    trv_guid=D:1234    dep_date=20181210
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    # Inbound AP Dep Date
    Generate Test Data For Agency Preferences From File    file=FNC_027_ap_data.csv
    #Boundry CP Dep Date Valid From
    Generate Test Data For Client Preferences From File    file=FNC_027_cp_data.csv
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.3    boost_cp=0.4
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_027_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_027_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_027_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_027_v3_results.json

FNC_028 Score Is Succesfully Retrieved With No AP, CP Data
    [Documentation]    Scenario:
    ...
    ...    >> No AP and CP Data Provided
    ...
    ...    >> Expecting No Score in response
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Generate Test Variables For Personalization Score    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_028_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_028_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_028_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_028_v3_results.json

FNC_034 Response Contains The Same Transaction ID Supplied In The Request
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    txn_id=ABCD12345
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct

FNC_035 Response Contains A System Generated Transaction ID When Not Supplied In The Request
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    txn_id=None
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct

FNC_036 Score Is Successfully Retrieved When useDataSet/experimentGroupTypeCode Is Available As B
    [Documentation]    Scenario :
    ...    useDataSet(V1)/experimentGroupTypeCode(V2 onwards)
    ...
    ...    >> Algorithm and experimentGroupTypeCode is B
    ...
    ...    >> Multiple AP and CP Matchinig and Non Matching Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Generate Test Variables For Personalization Score    csu_guid=C:1234    prefix=B    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata    group=B
    # Single Matching AP, CP and Boost Data
    Generate Test Data For Agency Preferences From File    file=FNC_036_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_036_cp_data.csv
    Generate Test Variables And Data For Boost    boost_tp=0.5    boost_ap=0.3    boost_cp=0.7
    # Non-Matching AP, CP and Boost Data
    Generate Test Data For Agency Preferences From File    file=FNC_036_ap_data.csv    ap_version=V0
    Generate Test Data For Client Preferences From File    file=FNC_036_cp_data.csv    cp_version=V0
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_036_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_036_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_036_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_036_v3_results.json

FNC_037 Score Is Successfully Retrieved When useDataSet/experimentGroupTypeCode Is Not Available
    [Documentation]    Scenario :
    ...    useDataSet(V1)/experimentGroupTypeCode(V2 onwards)
    ...
    ...    >> Algorithm is A \ and experimentGroupTypeCode is None
    ...
    ...    >> Multiple AP and CP Matchinig and Non Matching Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Create TP Meta Data
    Generate Test Variables For Personalization Score    prefix=None    csu_guid=C:4567    trv_guid=D:1234
    Create Test Data For Metadata    group=A
    # Single Matching AP, CP and Boost Data
    Generate Test Data For Agency Preferences From File    file=FNC_037_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_037_cp_data.csv
    Generate Test Variables And Data For Boost    boost_tp=0.4    boost_ap=0.2    boost_cp=0.8
    # Non-Matching AP, CP and Boost Data
    Generate Test Data For Agency Preferences From File    file=FNC_037_ap_data_v1.csv    ap_version=V2    ap_version_override=true
    Generate Test Data For Client Preferences From File    file=FNC_037_cp_data_v1.csv    cp_version=V2
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_037_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_037_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_037_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_037_v3_results.json

FNC_038 Score Is Successfully Retrieved When useDataSet/experimentGroupTypeCode
    [Documentation]    Scenario :
    ...    useDataSet(V1)/experimentGroupTypeCode(V2 onwards)
    ...
    ...    >> Algorithm is A \ and experimentGroupTypeCode is None
    ...
    ...    >> Multiple AP and CP Matchinig and Non Matching Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata
    # Single Matching AP, CP and Boost Data
    Generate Test Data For Agency Preferences From File    file=FNC_038_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_038_cp_data.csv
    Generate Test Variables And Data For Boost    boost_tp=0.5    boost_ap=0.3    boost_cp=0.7
    # Non-Matching AP, CP and Boost Data
    Generate Test Data For Agency Preferences From File    file=FNC_038_ap_data.csv    ap_version=V0
    Generate Test Data For Client Preferences From File    file=FNC_038_cp_data.csv    cp_version=V0
    Generate Test Variables And Data For Boost    boost_version=V0    boost_tp=0.4    boost_ap=0.2    boost_cp=0.8
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_038_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_038_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_038_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_038_v3_results.json

FNC_044 Verify The Eligibility Using Specific ClientSubUnitGuid Rule
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    ${match_csu_guid_A:1234}
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Matching csu_guid
    Generate Test Variables For Personalization Score    csu_guid=A:1234    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata
    Create Test Data For Metadata    app_id=MyCWT_Mobile    group=DEFAULT
    Generate Test Data For Agency Preferences From File    file=FNC_044_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_044_cp_data.csv
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_044_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_044_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_044_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_044_v3_results.json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Non-Matching csu_guid
    Generate Test Variables For Personalization Score    csu_guid=B:1234    trv_guid=D:1234
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_044_v2_results(personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_044_v2.2_results(personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_044_v3_results(personalization_off).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Matching ctu_guid
    Generate Test Variables For Personalization Score    csu_guid=E:8910    trv_guid=D:1234
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_044_v1_results(rule_matching_with_ctu).json    True
    Verify The Personalization Score When Version Is V2    FNC_044_v2_results(rule_matching_with_ctu).json    True
    Verify The Personalization Score When Version Is V2.2    FNC_044_v2.2_results(rule_matching_with_ctu).json    True
    Verify The Personalization Score When Version Is V3    FNC_044_v3_results(rule_matching_with_ctu).json    True

FNC_045 Verify The Eligibility Using Specific POS Country Rule
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Add Rules In Redis    ${match_pos_country_ASA}
    #Match POS Region And Match POS Country
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    iss_country=SG
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Data For Agency Preferences From File    file=FNC_045_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_045_cp_data.csv
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_045_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_045_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_045_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_045_v3_results.json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Match POS Region But Non-Match POS Country
    Create Test Data For Metadata    group=DEFAULT
    Generate Test Variables For Personalization Score    iss_country=JP
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_045_v2_results(JP_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_045_v2.2_results(JP_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_045_v3_results(JP_personalization_off).json
    Delete Features Collecton In MongoDB And Redis
    #Match POS Region And Match POS Country
    Add Rules In Redis    .*?::.*?::.*?::.*?::NAM::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::ON
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    iss_country=US
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_045_v1_results(US_personalization_on).json
    Verify The Personalization Score When Version Is V2    FNC_045_v2_results(US_personalization_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_045_v2.2_results(US_personalization_on).json
    Verify The Personalization Score When Version Is V3    FNC_045_v3_results(US_personalization_on).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Non-Match POS Region And Non-Match POS Country
    Generate Test Variables For Personalization Score    iss_country=GB
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_045_v2_results(GB_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_045_v2.2_results(GB_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_045_v3_results(GB_personalization_off).json

FNC_046 Verify The Eligibility Using Specific Origin Airport Rule
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    ${match_origin_airport_EUR}
    # Matching Origin Airport
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    origin=BQH    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata
    Create Test Data For Metadata    group=DEFAULT
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_046_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_046_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_046_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_046_v3_results.json
    # Matching Origin Country
    Generate Test Variables For Personalization Score    origin=LHR    destination=JFK
    Generate Test Data For Agency Preferences From File    file=FNC_046_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_046_cp_data.csv
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_046_v1_results(LHR_personalization_on).json
    Verify The Personalization Score When Version Is V2    FNC_046_v2_results(LHR_personalization_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_046_v2.2_results(LHR_personalization_on).json
    Verify The Personalization Score When Version Is V3    FNC_046_v3_results(LHR_personalization_on).json
    # Matching Origin Region
    Generate Test Variables For Personalization Score    origin=JFK    trv_guid=D:1234
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_046_v1_results(JFK_personalization_on).json
    Verify The Personalization Score When Version Is V2    FNC_046_v2_results(JFK_personalization_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_046_v2.2_results(JFK_personalization_on).json
    Verify The Personalization Score When Version Is V3    FNC_046_v3_results(JFK_personalization_on).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Non-Matching Origin Airport
    Generate Test Variables For Personalization Score    origin=OKO
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_046_v2_results(OKO_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_046_v2.2_results(OKO_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_046_v3_results(OKO_personalization_off).json
    # Non-Matching Origin Country
    Generate Test Variables For Personalization Score    origin=MNL
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_046_v2_results(MNL_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_046_v2.2_results(MNL_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_046_v3_results(MNL_personalization_off).json
    # Non-Matching Origin Region
    Generate Test Variables For Personalization Score    origin=HND
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_046_v2_results(HND_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_046_v2.2_results(HND_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_046_v3_results(HND_personalization_off).json

FNC_047 Verify The Eligibility Using Specific Destination Airport Rule
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Create Test Data For Metadata
    Add Rules In Redis    ${match_destination_airport_ASA}
    # Matching Destination Airport
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    destination=OKO
    Create TP Meta Data
    Create Test Data For Metadata
    Create Test Data For Metadata    group=DEFAULT
    Generate Test Data For Agency Preferences From File    file=FNC_047_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_047_cp_data.csv
    Generate Test Variables And Data For Boost    boost_ap=0.5    boost_cp=0.8
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_047_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_047_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_047_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_047_v3_results.json
    # Matching Origin Country
    Generate Test Variables For Personalization Score    destination=HND
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_047_v1_results(HND_personalization_on).json
    Verify The Personalization Score When Version Is V2    FNC_047_v2_results(HND_personalization_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_047_v2.2_results(HND_personalization_on).json
    Verify The Personalization Score When Version Is V3    FNC_047_v3_results(HND_personalization_on).json
    # Matching Origin Region
    Generate Test Variables For Personalization Score    destination=STN    trv_guid=D:1234
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_047_v1_results(STN_personalization_on).json
    Verify The Personalization Score When Version Is V2    FNC_047_v2_results(STN_personalization_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_047_v2.2_results(STN_personalization_on).json
    Verify The Personalization Score When Version Is V3    FNC_047_v3_results(STN_personalization_on).json
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Non-Matching Origin Airport
    Generate Test Variables For Personalization Score    destination=JRB
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_047_v2_results(JRB_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_047_v2.2_results(JRB_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_047_v3_results(JRB_personalization_off).json
    # Non-Matching Origin Country
    Generate Test Variables For Personalization Score    destination=MNL
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_047_v2_results(MNL_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_047_v2.2_results(MNL_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_047_v3_results(MNL_personalization_off).json
    # Non-Matching Origin Region
    Generate Test Variables For Personalization Score    destination=ZSF
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_047_v2_results(ZSF_personalization_off).json
    Verify The Personalization Score When Version Is V2.2    FNC_047_v2.2_results(ZSF_personalization_off).json
    Verify The Personalization Score When Version Is V3    FNC_047_v3_results(ZSF_personalization_off).json

FNC_048 Verify The Eligibility Using Specific Channel Rule
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Add Rules In Redis    ${match_channel_Desktop_Amadeus}
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Non-Matching Channel
    Generate Test Variables For Personalization Score    app_id=MyCWT_Mobile
    Create TP Meta Data
    Create Test Data For Metadata    group=DEFAULT
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    Create Test Data For Metadata    group=DEFAULT
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AA
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_048_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_048_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_048_v3_results.json
    #Matching Channel
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    app_id=Desktop_Amadeus
    Generate Test Variables And Data For Boost    boost_app_id=Desktop_Amadeus    boost_cp=0.5
    Send Personalization Score Request
    Verify The Personalization Score When Version Is V1    FNC_048_v1_results(matching_channel).json
    Verify The Personalization Score When Version Is V2    FNC_048_v2_results(matching_channel).json
    Verify The Personalization Score When Version Is V2.2    FNC_048_v2.2_results(matching_channel).json
    Verify The Personalization Score When Version Is V3    FNC_048_v3_results(matching_channel).json

FNC_049 Verify The Eligibility Using Specific All Rules And Switch Is OFF
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Add Rules In Redis    ${rules_off}
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Request
    Generate Test Variables For Personalization Score    csu_guid=A:1234    iss_country=SG    origin=BQH    destination=CEF    dep_date=20181205
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AA
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AA
    Generate Test Variables And Data For Boost    boost_ap=0.5    boost_cp=0.2
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_049_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_049_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_049_v3_results.json

FNC_050 Verify The Eligibility Using Multiple Request And Multiple Rules Criteria
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    ${multiple_rules_criteria}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Matching With Csu_guid
    Generate Test Variables For Personalization Score    csu_guid=B:4567    iss_country=PH    origin=LGA    destination=NRT
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Data For Agency Preferences From File    file=FNC_050_ap_data.csv
    Generate Test Data For Client Preferences From File    file=FNC_050_cp_data.csv
    Delete All Redis Keys Using Pattern    RULES*
    Replace Strings In Variables    multiple_rules_criteria,.*?::B:4567::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::JP::.*?::MYCWT_MOBILE::OFF,.*?::B:4567::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::JP::.*?::MYCWT_MOBILE::ON
    Add Rules In Redis    ${multiple_rules_criteria}
    Generate Test Variables And Data For Boost    boost_cp=0.9    boost_ap=0.2
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_050_v1_results(matching_with_csuguid).json
    Verify The Personalization Score When Version Is V2    FNC_050_v2_results(matching_with_csuguid).json
    Verify The Personalization Score When Version Is V2.2    FNC_050_v2.2_results(matching_with_csuguid).json
    Verify The Personalization Score When Version Is V3    FNC_050_v3_results(matching_with_csuguid).json
    Replace Strings In Variables    multiple_rules_criteria,.*?::B:4567::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::JP::.*?::MYCWT_MOBILE::ON,.*?::B:4567::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::JP::.*?::MYCWT_MOBILE::OFF
    #Matching With Origin And Destination Exact Match
    Generate Test Variables For Personalization Score    csu_guid=A:1111    iss_country=GB    origin=JRB    destination=LGW    trv_guid=D:1234
    Delete All Redis Keys Using Pattern    RULES*
    Replace Strings In Variables    multiple_rules_criteria,.*?::A:1111::.*?::.*?::.*?::GB::NAM::US::JRB::EUR::GB::LGW::MYCWT_MOBILE::OFF,.*?::A:1111::.*?::.*?::.*?::GB::NAM::US::JRB::EUR::GB::LGW::MYCWT_MOBILE::ON
    Add Rules In Redis    ${multiple_rules_criteria}
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_050_v1_results(matching_origin_destination).json
    Verify The Personalization Score When Version Is V2    FNC_050_v2_results(matching_origin_destination).json
    Verify The Personalization Score When Version Is V2.2    FNC_050_v2.2_results(matching_origin_destination).json
    Verify The Personalization Score When Version Is V3    FNC_050_v3_results(matching_origin_destination).json
    Replace Strings In Variables    multiple_rules_criteria,.*?::A:1111::.*?::.*?::.*?::GB::NAM::US::JRB::EUR::GB::LGW::MyCWT_Mobile::ON,.*?::A:1111::.*?::.*?::.*?::GB::NAM::US::JRB::EUR::GB::LGW::MyCWT_Mobile::OFF
    #Matching With POS Region
    Generate Test Variables For Personalization Score    iss_country=GB    trv_guid=D:1234
    Delete All Redis Keys Using Pattern    RULES*
    Replace Strings In Variables    multiple_rules_criteria,.*?::.*?::.*?::.*?::EUR::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::OFF,.*?::.*?::.*?::.*?::EUR::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::ON
    Add Rules In Redis    ${multiple_rules_criteria}
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_050_v1_results(matching_pos_region).json
    Verify The Personalization Score When Version Is V2    FNC_050_v2_results(matching_pos_region).json
    Verify The Personalization Score When Version Is V2.2    FNC_050_v2.2_results(matching_pos_region).json
    Verify The Personalization Score When Version Is V3    FNC_050_v3_results(matching_pos_region).json
    Replace Strings In Variables    multiple_rules_criteria,.*?::.*?::.*?::.*?::EUR::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::ON,.*?::.*?::.*?::.*?::EUR::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::OFF
    #Matching With Ctu_guid
    Generate Test Variables For Personalization Score    csu_guid=A:1111    trv_guid=D:1234
    Delete All Redis Keys Using Pattern    RULES*
    Replace Strings In Variables    multiple_rules_criteria,A:0::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::OFF,A:0::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::ON
    Add Rules In Redis    ${multiple_rules_criteria}
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_050_v1_results(matching_ctuguid).json
    Verify The Personalization Score When Version Is V2    FNC_050_v2_results(matching_ctuguid).json
    Verify The Personalization Score When Version Is V2.2    FNC_050_v2.2_results(matching_ctuguid).json
    Verify The Personalization Score When Version Is V3    FNC_050_v3_results(matching_ctuguid).json
    Replace Strings In Variables    multiple_rules_criteria,A:0::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::ON,A:0::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::OFF
    #Matching With Origin_country And Destination_Airport With Ctu_guid
    Generate Test Variables For Personalization Score    origin=LGA    destination=NRT    trv_guid=D:1234
    Delete All Redis Keys Using Pattern    RULES*
    Replace Strings In Variables    multiple_rules_criteria,B:1::.*?::.*?::.*?::.*?::.*?::.*?::US::.*?::.*?::.*?::NRT::.*?::OFF,B:1::.*?::.*?::.*?::.*?::.*?::.*?::US::.*?::.*?::.*?::NRT::.*?::ON
    Add Rules In Redis    ${multiple_rules_criteria}
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_050_v1_results(matching_origin_destination_with_ctuguid).json
    Verify The Personalization Score When Version Is V2    FNC_050_v2_results(matching_origin_destination_with_ctuguid).json
    Verify The Personalization Score When Version Is V2.2    FNC_050_v2.2_results(matching_origin_destination_with_ctuguid).json
    Verify The Personalization Score When Version Is V3    FNC_050_v3_results(matching_origin_destination_with_ctuguid).json
    Replace Strings In Variables    multiple_rules_criteria,A:0::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::ON,A:0::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::OFF
    #Matching With Origin_region And Destination_country With POS Region
    Generate Test Variables For Personalization Score    origin=LGW    destination=MNL    trv_guid=D:1234
    Delete All Redis Keys Using Pattern    RULES*
    Replace Strings In Variables    multiple_rules_criteria,.*?::.*?::.*?::.*?::NAM::.*?::EUR::.*?::.*?::.*?::PH::.*?::.*?::OFF,.*?::.*?::.*?::.*?::NAM::.*?::EUR::.*?::.*?::.*?::PH::.*?::.*?::ON
    Add Rules In Redis    ${multiple_rules_criteria}
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_050_v1_results(matching_origin_destination_pos_region).json
    Verify The Personalization Score When Version Is V2    FNC_050_v2_results(matching_origin_destination_pos_region).json
    Verify The Personalization Score When Version Is V2.2    FNC_050_v2.2_results(matching_origin_destination_pos_region).json
    Verify The Personalization Score When Version Is V3    FNC_050_v3_results(matching_origin_destination_pos_region).json
    Replace Strings In Variables    multiple_rules_criteria,.*?::.*?::.*?::.*?::NAM::.*?::EUR::.*?::.*?::.*?::PH::.*?::.*?::ON,.*?::.*?::.*?::.*?::NAM::.*?::EUR::.*?::.*?::.*?::PH::.*?::.*?::OFF
    #Matching With Origin_region And Destination_region
    Generate Test Variables For Personalization Score    origin=MNL    destination=NRT    trv_guid=D:1234
    Delete All Redis Keys Using Pattern    RULES*
    Replace Strings In Variables    multiple_rules_criteria,.*?::.*?::.*?::.*?::.*?::.*?::ASA::.*?::.*?::ASA::.*?::.*?::.*?::OFF,.*?::.*?::.*?::.*?::.*?::.*?::ASA::.*?::.*?::ASA::.*?::.*?::.*?::ON
    Add Rules In Redis    ${multiple_rules_criteria}
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_050_v1_results(matching_origin_destination_region).json
    Verify The Personalization Score When Version Is V2    FNC_050_v2_results(matching_origin_destination_region).json
    Verify The Personalization Score When Version Is V2.2    FNC_050_v2.2_results(matching_origin_destination_region).json
    Verify The Personalization Score When Version Is V3    FNC_050_v3_results(matching_origin_destination_region).json

FNC_051 Verify The Eligibility Using Multiple Rules Request have Exact Match Rules
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    ${exact_match_csu_origin_destination_a}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Generate Test Data
    Generate Test Variables For Personalization Score    csu_guid=A:1111    iss_country=GB    origin=JRB    destination=LGW    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_051_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_051_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_051_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_051_v3_results.json
    # Generate Test Data
    Generate Test Variables For Personalization Score    iss_country=US    origin=JFK    destination=LHR    dep_date=20181201    csu_guid=B:456
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AA
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_051_v1_2_results.json
    Verify The Personalization Score When Version Is V2    FNC_051_v2_2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_051_v2.2_2_results.json
    Verify The Personalization Score When Version Is V3    FNC_051_v3_2_results.json
    # Generate Test Data
    Generate Test Variables For Personalization Score    iss_country=US    origin=BQH    destination=CEF    dep_date=20181201    csu_guid=B:456    trv_guid=D:1234
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_051_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_051_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_051_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_051_v3_results.json
    # Generate Test Data
    Generate Test Variables For Personalization Score    iss_country=JP    origin=MNL    destination=NRT    dep_date=20181201    csu_guid=B:456    trv_guid=D:1234
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AB
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_051_v1_3_results.json
    Verify The Personalization Score When Version Is V2    FNC_051_v2_3_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_051_v2.2_3_results.json
    Verify The Personalization Score When Version Is V3    FNC_051_v3_3_results.json

FNC_052 Verify The Eligibility Using Multiple Rules Request have Partial Match Rules
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    ${partial_match_csu_origin_destination_a}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Generate Test Data
    Generate Test Variables For Personalization Score    csu_guid=A:1111    iss_country=GB    origin=JRB    destination=LGW    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_052_v1_results(JRB_LGW).json
    Verify The Personalization Score When Version Is V2    FNC_052_v2_results(JRB_LGW).json
    Verify The Personalization Score When Version Is V2.2    FNC_052_v2.2_results(JRB_LGW).json
    Verify The Personalization Score When Version Is V3    FNC_052_v3_results(JRB_LGW).json
    # Generate Test Data
    Generate Test Variables For Personalization Score    iss_country=US    origin=JFK    destination=LHR    dep_date=20181201    csu_guid=B:456
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AA
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_052_v1_results(JFK_LHR).json
    Verify The Personalization Score When Version Is V2    FNC_052_v2_results(JFK_LHR).json
    Verify The Personalization Score When Version Is V2.2    FNC_052_v2.2_results(JFK_LHR).json
    Verify The Personalization Score When Version Is V3    FNC_052_v3_results(JFK_LHR).json
    # Generate Test Data
    Generate Test Variables For Personalization Score    iss_country=US    origin=BQH    destination=CEF    dep_date=20181201    csu_guid=B:456    trv_guid=D:1234
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_052_v1_results(BQH_CEF).json
    Verify The Personalization Score When Version Is V2    FNC_052_v2_results(BQH_CEF).json
    Verify The Personalization Score When Version Is V2.2    FNC_052_v2.2_results(BQH_CEF).json
    Verify The Personalization Score When Version Is V3    FNC_052_v3_results(BQH_CEF).json
    # Generate Test Data
    Generate Test Variables For Personalization Score    iss_country=JP    origin=MNL    destination=NRT    dep_date=20181201    csu_guid=B:456    trv_guid=D:1234
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AB
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_052_v1_results(MNL_NRT).json
    Verify The Personalization Score When Version Is V2    FNC_052_v2_results(MNL_NRT).json
    Verify The Personalization Score When Version Is V2.2    FNC_052_v2.2_results(MNL_NRT).json
    Verify The Personalization Score When Version Is V3    FNC_052_v3_results(MNL_NRT).json

FNC_053 Verify The Eligibility When There Is No Rule
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    csu_guid=A:1234    iss_country=SG    origin=BQH    destination=CEF
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AA
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_053_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_053_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_053_v3_results.json

FNC_077 Verify The Eligibility Using Direction Rule
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis 2    ${match_bidirectional_JFK_LHR}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Matching Origin - Destination Directional
    Generate Test Variables For Personalization Score    origin=JFK    destination=LHR
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AA
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    200
    Verify The Personalization Score When Version Is V1    FNC_077_v1_results(origin-destination_directional).json
    Verify The Personalization Score When Version Is V2    FNC_077_v2_results(origin-destination_directional).json
    Verify The Personalization Score When Version Is V2.2    FNC_077_v2.2_results(origin-destination_directional).json
    Verify The Personalization Score When Version Is V3    FNC_077_v3_results(origin-destination_directional).json
    #Matching Origin - Destination Bidirectional
    Generate Test Variables For Personalization Score    origin=LHR    destination=JFK    trv_guid=D:1234
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AB
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    200
    Verify The Personalization Score When Version Is V1    FNC_077_v1_results(origin-destination_bidirectional).json
    Verify The Personalization Score When Version Is V2    FNC_077_v2_results(origin-destination_bidirectional).json
    Verify The Personalization Score When Version Is V2.2    FNC_077_v2.2_results(origin-destination_bidirectional).json
    Verify The Personalization Score When Version Is V3    FNC_077_v3_results(origin-destination_bidirectional).json
    Delete Features Collecton In MongoDB And Redis
    Generate Test Data For Features    api_version_feature=v1    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Non-Matching Origin Airport
    Generate Test Variables For Personalization Score    origin=OKO    destination=LHR
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=AC
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_077_v2_results(non_matching_origin-destination).json
    Verify The Personalization Score When Version Is V2.2    FNC_077_v2.2_results(non_matching_origin-destination).json
    Verify The Personalization Score When Version Is V3    FNC_077_v3_results(non_matching_origin-destination).json

FNC_104 Verify The Eligibility Using Specific pcc Rule Only For Desktop_Amadeus
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    .*?::.*?::A1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_AMADEUS::ON
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Matching pcc rules
    Generate Test Variables For Personalization Score    pcc=A1234    app_id=Desktop_Amadeus    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=DEFAULT
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=BC    ap_score=0.1
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=BC    cp_policy_order=1
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_104_v1_results(matching_pcc).json
    Verify The Personalization Score When Version Is V2    FNC_104_v2_results(matching_pcc).json
    Verify The Personalization Score When Version Is V2.2    FNC_104_v2.2_results(matching_pcc).json
    Verify The Personalization Score When Version Is V3    FNC_104_v3_results(matching_pcc).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Non-Matching pcc rules (PCC is different with rules)
    Generate Test Variables For Personalization Score    pcc=B1234    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_104_v2_results(non_matching_pcc).json
    Verify The Personalization Score When Version Is V2.2    FNC_104_v2.2_results(non_matching_pcc).json
    Verify The Personalization Score When Version Is V3    FNC_104_v3_results(non_matching_pcc).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #pcc rules is matched but personalization is OFF And CP_Pass is True
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    .*?::.*?::A1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_AMADEUS::OFF
    Generate Test Variables For Personalization Score    pcc=A1234    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_104_v2_results(pcc_rules_off_cp_pass_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_104_v2.2_results(pcc_rules_off_cp_pass_on).json
    Verify The Personalization Score When Version Is V3    FNC_104_v3_results(pcc_rules_off_cp_pass_on).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #pcc rules is matched but personalization is OFF And CP_Pass is False
    Generate Test Variables For Personalization Score    pcc=A1234    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2.2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V3    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #PCC Is Empty In Request But Rules added in Redis And CP_Pass is True
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    .*?::.*?::A1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_AMADEUS::ON
    Generate Test Variables For Personalization Score    pcc=${EMPTY}    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_104_v2_results(pcc_empty).json
    Verify The Personalization Score When Version Is V2.2    FNC_104_v2.2_results(pcc_empty).json
    Verify Error Message When Version Is V3    error_status=400    error_code=INPUT_VALIDATION_ERROR    error_message=pcc: must not be blank
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #PCC Is None In Request But Rules added in Redis And CP_Pass is True
    Generate Test Variables For Personalization Score    pcc=None    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_104_v2_results(pcc_none).json
    Verify The Personalization Score When Version Is V2.2    FNC_104_v2.2_results(pcc_none).json
    Verify Error Message When Version Is V3    error_status=400    error_code=INPUT_VALIDATION_ERROR    error_message=pcc: must not be blank
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #PCC Is None In Request But Rules added in Redis And CP_Pass is False
    Generate Test Variables For Personalization Score    pcc=None    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2.2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V3    error_status=400    error_code=INPUT_VALIDATION_ERROR    error_message=pcc: must not be blank

FNC_105 Verify The Eligibility Using Specific pcc Rule Only For Desktop_Sabre
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    .*?::.*?::A1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_SABRE::ON
    Generate Test Data For Features    app_id=Desktop_Sabre    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Matching pcc rules
    Generate Test Variables For Personalization Score    pcc=A1234    app_id=Desktop_Sabre    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Sabre
    Create Test Data For Metadata    app_id=Desktop_Sabre    group=DEFAULT
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=BC    ap_score=0.1
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=BC    cp_policy_order=1
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_105_v1_results(matching_pcc).json
    Verify The Personalization Score When Version Is V2    FNC_105_v2_results(matching_pcc).json
    Verify The Personalization Score When Version Is V2.2    FNC_105_v2.2_results(matching_pcc).json
    Verify The Personalization Score When Version Is V3    FNC_105_v3_results(matching_pcc).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Sabre    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Sabre    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Sabre    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Sabre    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Non-Matching pcc rules
    Generate Test Variables For Personalization Score    pcc=B1234    app_id=Desktop_Sabre
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_105_v2_results(non_matching_pcc).json
    Verify The Personalization Score When Version Is V2.2    FNC_105_v2.2_results(non_matching_pcc).json
    Verify The Personalization Score When Version Is V3    FNC_105_v3_results(non_matching_pcc).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Sabre    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Sabre    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Sabre    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Sabre    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #pcc rules is OFF And CP_Pass is True
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    .*?::.*?::A1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_SABRE::OFF
    Generate Test Variables For Personalization Score    pcc=A1234    app_id=Desktop_Sabre
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_105_v2_results(pcc_rules_off_cp_pass_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_105_v2.2_results(pcc_rules_off_cp_pass_on).json
    Verify The Personalization Score When Version Is V3    FNC_105_v3_results(pcc_rules_off_cp_pass_on).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Sabre    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Sabre    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Sabre    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Sabre    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #pcc rules And CP_pass is False
    Generate Test Variables For Personalization Score    pcc=A1234    app_id=Desktop_Sabre
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2.2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V3    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.

FNC_106 Verify The Eligibility Using Specific pcc Rule For MyCwt_Mobile And Specified Pcc
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    .*?::.*?::A1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::MYCWT_MOBILE::ON|.*?::.*?::B1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::MYCWT_WEB::OFF|.*?::.*?::B1234::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::MYCWT_MOBILE::ON
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Matching pcc rules
    Generate Test Variables For Personalization Score    pcc=B1234    app_id=MyCWT_Mobile    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    Create Test Data For Metadata    app_id=MyCWT_Mobile    group=DEFAULT
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=BC    ap_score=0.1
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=BC    cp_policy_order=1
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_106_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_106_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_106_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_106_v3_results.json

FNC_112 Verify The Eligibility Using Specific agentId Rule Only For Desktop_Amadeus
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    .*?::.*?::.*?::AGENT1::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_AMADEUS::ON
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Matching agentId rules
    Generate Test Variables For Personalization Score    agent_id=agent1    app_id=Desktop_Amadeus    trv_guid=D:1234
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=DEFAULT
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=BC    ap_score=0.1
    Generate Test Variables And Data For Client Preferences    cp_carrier_code=BC    cp_policy_order=1
    Generate Test Variables And Data For Boost
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify The Personalization Score When Version Is V1    FNC_112_v1_results(matching_agent_id).json
    Verify The Personalization Score When Version Is V2    FNC_112_v2_results(matching_agent_id).json
    Verify The Personalization Score When Version Is V2.2    FNC_112_v2.2_results(matching_agent_id).json
    Verify The Personalization Score When Version Is V3    FNC_112_v3_results(matching_agent_id).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Non-Matching agentId rules (Agent ID is different with rules)
    Generate Test Variables For Personalization Score    agent_id=agent2    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_112_v2_results(non_matching_agent_id).json
    Verify The Personalization Score When Version Is V2.2    FNC_112_v2.2_results(non_matching_agent_id).json
    Verify The Personalization Score When Version Is V3    FNC_112_v3_results(non_matching_agent_id).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #agentId rules is matched but personalization is OFF And CP_Pass is True
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    .*?::.*?::.*?::AGENT1::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_AMADEUS::OFF
    Generate Test Variables For Personalization Score    agent_id=agent1    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_112_v2_results(agent_id_rules_off_cp_pass_on).json
    Verify The Personalization Score When Version Is V2.2    FNC_112_v2.2_results(agent_id_rules_off_cp_pass_on).json
    Verify The Personalization Score When Version Is V3    FNC_112_v3_results(agent_id_rules_off_cp_pass_on).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #agentId rules is matched but personalization is OFF And CP_Pass is False
    Generate Test Variables For Personalization Score    agent_id=agent1    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2.2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V3    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #agentId Is Empty In Request But Rules added in Redis And CP_Pass is True
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    .*?::.*?::.*?::AGENT1::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::DESKTOP_AMADEUS::ON
    Generate Test Variables For Personalization Score    agent_id=${EMPTY}    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_112_v2_results(agent_id_empty).json
    Verify The Personalization Score When Version Is V2.2    FNC_112_v2.2_results(agent_id_empty).json
    Verify The Personalization Score When Version Is V3    FNC_112_v3_results(agent_id_empty).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Agent ID Is None In Request But Rules added in Redis And CP_Pass is True
    Generate Test Variables For Personalization Score    agent_id=None    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify The Personalization Score When Version Is V2    FNC_112_v2_results(agent_id_none).json
    Verify The Personalization Score When Version Is V2.2    FNC_112_v2.2_results(agent_id_none).json
    Verify The Personalization Score When Version Is V3    FNC_112_v3_results(agent_id_none).json
    Delete Features Collecton In MongoDB And Redis
    #Add Features
    Generate Test Data For Features    api_version_feature=v1    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v2.2    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Features    api_version_feature=v3    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    #Agent ID Is None In Request But Rules added in Redis And CP_Pass is False
    Generate Test Variables For Personalization Score    agent_id=None    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify Error Message When Version Is V1    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V2.2    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.
    Verify Error Message When Version Is V3    error_status=403    error_code=4004    error_message=Personalization is turned OFF for this request.

FNC_055 Traveler Preference Is Successfully Retrieved
    [Documentation]    >> In V3 response retrieving travelerguid with all carriercode.
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    trv_guid=A:1234
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Variables And Data For Boost
    Generate Test Data For Traveler Preference 2    V1,A:1234
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_055_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_055_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_055_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_055_v3_results.json

FNC_056 Traveler Preference Is Successfully Retrieved With Single Matching With Multiple Traveler (Same Dataset) and Boost Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    trv_guid=D:1234
    Generate Test Data For Traveler Preference 2    V1,D:1234|V1,B:4567
    Create TP Meta Data
    Create Test Data For Metadata
    #Single Matching Traveler And Boost Data
    Generate Test Variables And Data For Boost    boost_tp=0.1    boost_ap=0.2    boost_cp=0.3
    #Non-Matching Traveler And Boost Data
    Generate Test Variables And Data For Boost    boost_version=V0    boost_tp=0.4    boost_ap=0.5    boost_cp=0.6
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_056_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_056_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_056_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_056_v3_results.json

FNC_057 Traveler Preference Is Successfully Retrieved With Single Matching With Multiple Traveler (Different Dataset) and Boost Data Using useDataSet Header
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Create TP Meta Data
    Generate Test Variables For Personalization Score    trv_guid=D:1234    prefix=B
    Create Test Data For Metadata    group=B
    Generate Test Data For Traveler Preference 2    V2,A:1234|V1,D:1234
    #Single Matching Traveler And Boost Data
    Generate Test Variables And Data For Boost    boost_tp=0.7    boost_ap=0.8    boost_cp=0.9
    #Non-Matching Traveler And Boost Data
    Generate Test Variables And Data For Boost    boost_version=V0    boost_tp=0.1    boost_ap=0.2    boost_cp=0.3
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_057_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_057_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_057_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_057_v3_results.json
    [Teardown]    Delete Features Collecton In MongoDB And Redis

FNC_058 Traveler Preference Is Successfully Retrieved With Single Matching With Multiple Same Traveler (Different Dataset) And Boost Data Using useDataSet Header
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    trv_guid=D:1234    prefix=A
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Data For Traveler Preference 2    V1,D:1234|V2,A:1234
    #Single Matching Traveler And Boost Data
    Generate Test Variables And Data For Boost    boost_tp=0.5    boost_ap=0.3    boost_cp=0.7
    #Non-Matching Traveler And Boost Data
    Generate Test Variables And Data For Boost    boost_tp=0.6    boost_ap=0.8    boost_cp=0.9    boost_version=v3
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_058_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_058_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_058_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_058_v3_results.json
    [Teardown]    Delete Features Collecton In MongoDB And Redis

FNC_059 Traveler Preference Is Successfully Retrieved With Single Matching Using appId With Multiple Boost Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    trv_guid=D:1234    app_id=Desktop_Amadeus
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    Generate Test Data For Traveler Preference 2    V1,D:1234|V1,B:4567
    #Single Matching Traveler And Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=Desktop_Amadeus    boost_tp=0.1    boost_ap=0.3    boost_cp=0.2
    #Non-Matching Traveler And Boost Data
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_059_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_059_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_059_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_059_v3_results.json
    [Teardown]    Delete Features Collecton In MongoDB And Redis

FNC_060 No Traveler Preference Is Retrieved When Traveler Guid And Default TP Data Is Not Available In Redis
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    trv_guid=B:5678
    Create TP Meta Data
    Create Test Data For Metadata
    Generate Test Data For Traveler Preference 2    V1,A:1234
    # Non-Matching AP, CP And Bosst Data
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AA    ap_iss_country=C_US    ap_origin=A_SIN    ap_destination=A_MNL    ap_score=0.1
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AA    cp_origin=A_SIN    cp_destination=A_MNL    cp_score=0.2
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.9    boost_cp=0.8
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    400
    Verify That Response Headers Are Correct
    Verify That Error Response Is Returned    error_code=4014    error_message=Traveler/Default preference not found

FNC_065 Verify The Error Message When There Is No Boost Data
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score
    Create TP Meta Data
    Create Test Data For Metadata
    # Single Matching AP Data
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AA    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4015    error_message=Boost for the requested appId not found

FNC_067 Score Is Successfully Retrieved With Multiple Matching AP Data With Different RowId, Different Policy Order and Different Carrier Code (Actual Dna Data)
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    iss_country=GB    origin=JFK    destination=LHR    dep_date=20181202
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching AP Data With Origin Airport
    Generate Test Data For Agency Preferences From File    file=FNC_067_ap_data.csv
    #Matching Boost
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=1
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_067_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_067_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_067_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_067_v3_results.json

FNC_073 Score Is Successfully Retrieved When Airport Code And City Code Is Same
    [Documentation]    Scenario : Multiple CP Dintinct Data With Same Airport Code MNL and Same City Code MNL.
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    csu_guid=A:1234    origin=MNL    destination=LHR
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    FNC_073_cp_data.csv
    #Matching Boost
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=1    boost_cp=1
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_073_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_073_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_073_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_073_v3_results.json

FNC_074 Score Is Successfully Retrieved With Different Carrier Code And Same Policy Order And Direction Type Is Bidirectional
    [Documentation]    Scenario : Bi-directional Multiple CP Distinct and Non Matching Data With Different Carrier Code and Same Policy Order
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Variables For Personalization Score    csu_guid=A:1234    origin=JFK    destination=LHR
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    FNC_074_cp_data.csv
    #Matching Boost
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=1    boost_cp=1
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_074_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_074_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_074_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_074_v3_results.json

FNC_075 Score Is Successfully Retrieved With AP And CP Data With Dynamic Score
    [Documentation]    Scanario: Multiple AP And CP Distinct Data with Different Carrier Code and Different \ Policy Order with Dynamic Scoring
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,A:1234
    Generate Test Variables For Personalization Score    csu_guid=A:1234    trv_guid=A:1234    iss_country=GB    origin=JFK    destination=LHR
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching AP Data With Origin Airport
    Generate Test Data For Agency Preferences From File    file=FNC_075_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_075_cp_data.csv
    #Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_075_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_075_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_075_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_075_v3_results.json

FNC_076 Default Traveler Preference Is Retrieved When Traveler Guid Is Not Available In Redis
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=true
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    trv_guid=B:4567
    Generate Test Data For Traveler Preference 2    V1,DEFAULT
    Create TP Meta Data
    Create Test Data For Metadata
    # Single Matching AP, CP And Bosst Data
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AA    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AA    cp_origin=A_JFK    cp_destination=A_LHR    cp_score=0.2
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.9    boost_cp=0.8
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_076_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_076_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_076_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_076_v3_results.json
    [Teardown]    Delete All Redis Keys Using Pattern    V1::TRAVELER::*

FNC_077 Score Is Successfully Retrieved When OAG Is True In Feature
    [Tags]    not-ready
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=true    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Data For Traveler Preference 2    V1,C:8901
    Generate Test Variables For Personalization Score    trv_guid=C:8901    csu_guid=A:1234    iss_country=GB    origin=JFK    destination=LHR    dep_date=20190912
    ...    app_id=Desktop_Amadeus
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    #OAG Data Same Origin-Destination
    Generate Carriers OAG Data    CARRIERS::JFK::LHR,20191201::20190912::AA;20191201::20190712::AE;20190912::20190712::AI;20190911::20180912::AM;20191201::20190913::AQ;20191201::20190912::AU;20191201::20190912::AY;20191201::20190912::A3
    #OAG Data Different Origin-Destination
    Generate Carriers OAG Data    CARRIERS::MNL::SIN,20191201::20190912::AB;20191201::20190712::AF;20190912::20190712::AJ
    # Multiple Matching AP Data With Origin Airport
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AA    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=2
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AB    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=C_GB    ap_score=0.2
    ...    ap_policy_order=2
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AC    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=R_EUR    ap_score=0.3
    ...    ap_policy_order=2
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AD    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=G_YYYY    ap_score=0.4
    ...    ap_policy_order=2
    # Multiple Matching AP Data With Origin Country
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AE    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=A_LHR    ap_score=0.5
    ...    ap_policy_order=3
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AF    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=C_GB    ap_score=0.6
    ...    ap_policy_order=3
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AG    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=R_EUR    ap_score=0.7
    ...    ap_policy_order=3
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AH    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=G_YYYY    ap_score=0.8
    ...    ap_policy_order=3
    # Multiple Matching AP Data With Origin Region
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AI    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=A_LHR    ap_score=0.9
    ...    ap_policy_order=4
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AJ    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=C_GB    ap_score=1.10
    ...    ap_policy_order=4
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AK    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=R_EUR    ap_score=1.20
    ...    ap_policy_order=4
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AL    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=G_YYYY    ap_score=1.30
    ...    ap_policy_order=4
    # Multiple Matching AP Data With Origin Global
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AM    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=A_LHR    ap_score=1.40
    ...    ap_policy_order=5
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AN    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=C_GB    ap_score=1.50
    ...    ap_policy_order=5
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AO    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=R_EUR    ap_score=1.60
    ...    ap_policy_order=5
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AP    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=G_YYYY    ap_score=1.70
    ...    ap_policy_order=5
    # Multiple Matching AP Data With Origin Airport And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AQ    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=1.80
    ...    ap_policy_order=6
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AR    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=C_GB    ap_score=1.90
    ...    ap_policy_order=6
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AS    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=R_EUR    ap_score=2.00
    ...    ap_policy_order=6
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AT    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=G_YYYY    ap_score=2.10
    ...    ap_policy_order=6
    # Multiple Matching AP Data With Origin Country And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AU    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=A_LHR    ap_score=2.20
    ...    ap_policy_order=7
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AV    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=C_GB    ap_score=2.30
    ...    ap_policy_order=7
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AW    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=R_EUR    ap_score=2.40
    ...    ap_policy_order=7
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AX    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=G_YYYY    ap_score=2.50
    ...    ap_policy_order=7
    # Multiple Matching AP Data With Origin Region And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=AY    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=A_LHR    ap_score=2.60
    ...    ap_policy_order=8
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=AZ    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=C_GB    ap_score=2.70
    ...    ap_policy_order=8
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=A1    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=R_EUR    ap_score=2.80
    ...    ap_policy_order=8
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=A2    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=G_YYYY    ap_score=2.90
    ...    ap_policy_order=8
    # Multiple Matching AP Data With Origin Global And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A3    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=A_LHR    ap_score=3.00
    ...    ap_policy_order=9
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A4    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=C_GB    ap_score=3.10
    ...    ap_policy_order=9
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A5    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=R_EUR    ap_score=3.20
    ...    ap_policy_order=9
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A6    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=G_YYYY    ap_score=3.30
    ...    ap_policy_order=9
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AA    cp_origin=A_JFK    cp_destination=A_LHR    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AB    cp_origin=A_JFK    cp_destination=CI_LON    cp_policy_order=2
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AC    cp_origin=CI_NYC    cp_destination=A_LHR    cp_policy_order=3
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AD    cp_origin=A_JFK    cp_destination=C_GB    cp_policy_order=4
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AE    cp_origin=C_US    cp_destination=A_LHR    cp_policy_order=5
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AF    cp_origin=A_JFK    cp_destination=SR_EUROP    cp_policy_order=6
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AG    cp_origin=SR_NAMER    cp_destination=A_LHR    cp_policy_order=7
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AH    cp_origin=A_JFK    cp_destination=R_EMEA    cp_policy_order=8
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AI    cp_origin=R_NORAM    cp_destination=A_LHR    cp_policy_order=9
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AJ    cp_origin=A_JFK    cp_destination=G_YYYY    cp_policy_order=10
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AK    cp_origin=G_YYYY    cp_destination=A_LHR    cp_policy_order=11
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AL    cp_origin=CI_NYC    cp_destination=CI_LON    cp_policy_order=12
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AM    cp_origin=CI_NYC    cp_destination=C_GB    cp_policy_order=13
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AN    cp_origin=C_US    cp_destination=CI_LON    cp_policy_order=14
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AO    cp_origin=CI_NYC    cp_destination=SR_EUROP    cp_policy_order=15
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AP    cp_origin=SR_NAMER    cp_destination=CI_LON    cp_policy_order=16
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AQ    cp_origin=CI_NYC    cp_destination=R_EMEA    cp_policy_order=17
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AR    cp_origin=R_NORAM    cp_destination=CI_LON    cp_policy_order=18
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AS    cp_origin=CI_NYC    cp_destination=G_YYYY    cp_policy_order=19
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AT    cp_origin=G_YYYY    cp_destination=CI_LON    cp_policy_order=20
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AU    cp_origin=C_US    cp_destination=C_GB    cp_policy_order=21
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AV    cp_origin=C_US    cp_destination=SR_EUROP    cp_policy_order=22
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AW    cp_origin=SR_NAMER    cp_destination=C_GB    cp_policy_order=23
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AX    cp_origin=C_US    cp_destination=R_EMEA    cp_policy_order=24
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AY    cp_origin=R_NORAM    cp_destination=C_GB    cp_policy_order=25
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AZ    cp_origin=C_US    cp_destination=G_YYYY    cp_policy_order=26
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A0    cp_origin=G_YYYY    cp_destination=C_GB    cp_policy_order=27
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A1    cp_origin=SR_NAMER    cp_destination=SR_EUROP    cp_policy_order=28
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A2    cp_origin=SR_NAMER    cp_destination=R_EMEA    cp_policy_order=29
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A3    cp_origin=R_NORAM    cp_destination=SR_EUROP    cp_policy_order=30
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A4    cp_origin=SR_NAMER    cp_destination=G_YYYY    cp_policy_order=31
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A5    cp_origin=G_YYYY    cp_destination=SR_EUROP    cp_policy_order=32
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A6    cp_origin=R_NORAM    cp_destination=R_EMEA    cp_policy_order=33
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A7    cp_origin=R_NORAM    cp_destination=G_YYYY    cp_policy_order=34
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A8    cp_origin=G_YYYY    cp_destination=R_EMEA    cp_policy_order=35
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A9    cp_origin=G_YYYY    cp_destination=G_YYYY    cp_policy_order=36
    #Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Comment    Calculate And Compare Dynamic Scores    6    0.3    apScore
    Comment    Calculate And Compare Dynamic Scores    6    0.3    cpScore
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    {"version":"${exp_version}","experimentGroupTypeCode":"DATASET_${prefix}","result":{"score":[{"carrierCode":"AA","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":1,"apScore":0.3,"cpScore":0.3,"totalScore":0.6},{"carrierCode":"AE","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8571428571428572,"cpValue":0.8571428571428572,"apScore":0.25714287,"cpScore":0.25714287,"totalScore":0.51428574},{"carrierCode":"AI","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7142857142857143,"cpValue":0.7142857142857143,"apScore":0.21428573,"cpScore":0.21428573,"totalScore":0.42857146},{"carrierCode":"AU","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5714285714285714,"cpValue":0.5714285714285714,"apScore":0.17142859,"cpScore":0.17142859,"totalScore":0.34285718},{"carrierCode":"AY","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4285714285714286,"cpValue":0.4285714285714286,"apScore":0.12857144,"cpScore":0.12857144,"totalScore":0.25714287},{"carrierCode":"A3","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2857142857142857,"cpValue":0.2857142857142857,"apScore":0.085714296,"cpScore":0.085714296,"totalScore":0.17142859}],"travelerPreference":{"traveler_guid":"C:8901","carrier":[{"code":"AA","value":0.1},{"code":"AE","value":0.2},{"code":"AI","value":0.3},{"code":"AU","value":0.6},{"code":"AY","value":0.7},{"code":"A3","value":0.8}],"depart_ts":{"ts_window_1":0.1,"ts_window_2":0.2,"ts_window_n":0.3},"arrival_ts":{"ts_window_1":0.4,"ts_window_2":0.5,"ts_window_n":0.6},"num_stops":{"n0":0.7,"n1":0.8,"n2":0.7},"duration":0.6,"price":0.5},"boost":{"consumer":"Desktop_Amadeus","tpBoost":0.5,"cpBoost":0.3,"apBoost":0.3,"others":{"Factor1":"test"}},"meta":${tp_meta_data}}}
    Verify The Personalization Score When Version Is V2    {"version":"${exp_version}","experimentGroupTypeCode":"${prefix}","offlineAlgorithm":"${offline_algorithm}","onlineAlgorithm":"${online_algorithm}","personalizationApplied": ${pers_applied},"systemPersonalized":false,"result":{"score":[{"carrierCode":"AA","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":1,"cpPolicyOrder":1,"cpDerivedPolicyOrder":1,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.3,"totalScore":0.6},{"carrierCode":"AE","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8571428571428572,"cpValue":0.8571428571428572,"cpPolicyOrder":5,"cpDerivedPolicyOrder":2,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.25714287,"cpScore":0.25714287,"totalScore":0.51428574},{"carrierCode":"AI","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7142857142857143,"cpValue":0.7142857142857143,"cpPolicyOrder":9,"cpDerivedPolicyOrder":3,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.21428573,"cpScore":0.21428573,"totalScore":0.42857146},{"carrierCode":"AU","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5714285714285714,"cpValue":0.5714285714285714,"cpPolicyOrder":21,"cpDerivedPolicyOrder":4,"apPolicyOrder":7,"apDerivedPolicyOrder":4,"apScore":0.17142859,"cpScore":0.17142859,"totalScore":0.34285718},{"carrierCode":"AY","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4285714285714286,"cpValue":0.4285714285714286,"cpPolicyOrder":25,"cpDerivedPolicyOrder":5,"apPolicyOrder":8,"apDerivedPolicyOrder":5,"apScore":0.12857144,"cpScore":0.12857144,"totalScore":0.25714287},{"carrierCode":"A3","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2857142857142857,"cpValue":0.2857142857142857,"cpPolicyOrder":30,"cpDerivedPolicyOrder":6,"apPolicyOrder":9,"apDerivedPolicyOrder":6,"apScore":0.085714296,"cpScore":0.085714296,"totalScore":0.17142859}],"travelerPreference":{"traveler_guid":"C:8901","carrier":[{"code":"AA","value":0.1},{"code":"AE","value":0.2},{"code":"AI","value":0.3},{"code":"AU","value":0.6},{"code":"AY","value":0.7},{"code":"A3","value":0.8}],"depart_ts":{"ts_window_1":0.1,"ts_window_2":0.2,"ts_window_n":0.3},"arrival_ts":{"ts_window_1":0.4,"ts_window_2":0.5,"ts_window_n":0.6},"num_stops":{"n0":0.7,"n1":0.8,"n2":0.7},"duration":0.6,"price":0.5},"boost":{"tpBoost":0.5,"cpBoost":0.3,"apBoost":0.3,"priceBoost":${price},"durationBoost":${duration},"numStopsBoost":${num_stops},"flightTimeBoost":${flight_time}}}}
    Verify The Personalization Score When Version Is V2.2    {"version":"${exp_version}","experimentGroupTypeCode":"${prefix}","offlineAlgorithm":"${offline_algorithm}","onlineAlgorithm":"${online_algorithm}","personalizationApplied": ${pers_applied},"systemPersonalized":false,"result":{"score":[{"carrierCode":"AA","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode": "AA","cabinClass": "F","apValue":1,"cpValue":1,"cpPolicyOrder":1,"cpDerivedPolicyOrder":1,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.3,"totalScore":0.6},{"carrierCode":"AE","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode": "AA","cabinClass": "F","apValue":0.8571428571428572,"cpValue":0.8571428571428572,"cpPolicyOrder":5,"cpDerivedPolicyOrder":2,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.25714287,"cpScore":0.25714287,"totalScore":0.51428574},{"carrierCode":"AI","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode": "AA","cabinClass": "F","apValue":0.7142857142857143,"cpValue":0.7142857142857143,"cpPolicyOrder":9,"cpDerivedPolicyOrder":3,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.21428573,"cpScore":0.21428573,"totalScore":0.42857146},{"carrierCode":"AU","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode": "AA","cabinClass": "F","apValue":0.5714285714285714,"cpValue":0.5714285714285714,"cpPolicyOrder":21,"cpDerivedPolicyOrder":4,"apPolicyOrder":7,"apDerivedPolicyOrder":4,"apScore":0.17142859,"cpScore":0.17142859,"totalScore":0.34285718},{"carrierCode":"AY","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode": "AA","cabinClass": "F","apValue":0.4285714285714286,"cpValue":0.4285714285714286,"cpPolicyOrder":25,"cpDerivedPolicyOrder":5,"apPolicyOrder":8,"apDerivedPolicyOrder":5,"apScore":0.12857144,"cpScore":0.12857144,"totalScore":0.25714287},{"carrierCode":"A3","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode": "AA","cabinClass": "F","apValue":0.2857142857142857,"cpValue":0.2857142857142857,"cpPolicyOrder":30,"cpDerivedPolicyOrder":6,"apPolicyOrder":9,"apDerivedPolicyOrder":6,"apScore":0.085714296,"cpScore":0.085714296,"totalScore":0.17142859}],"travelerPreference":{"traveler_guid":"C:8901","carrier":[{"code":"AA","value":0.1},{"code":"AE","value":0.2},{"code":"AI","value":0.3},{"code":"AU","value":0.6},{"code":"AY","value":0.7},{"code":"A3","value":0.8}],"depart_ts":{"ts_window_1":0.1,"ts_window_2":0.2,"ts_window_n":0.3},"arrival_ts":{"ts_window_1":0.4,"ts_window_2":0.5,"ts_window_n":0.6},"num_stops":{"n0":0.7,"n1":0.8,"n2":0.7},"duration":0.6,"price":0.5},"boost":{"tpBoost":0.5,"cpBoost":0.3,"apBoost":0.3,"priceBoost":${price},"durationBoost":${duration},"numStopsBoost":${num_stops},"flightTimeBoost":${flight_time}}}}
    [Teardown]    Delete All Redis Keys Using Pattern    CARRIERS::*

FNC_078 Score Is Successfully Retrieved Without OAG Data When OAG Is False In Feature
    [Tags]    not-ready
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,C:8901
    Generate Test Variables For Personalization Score    trv_guid=C:8901    csu_guid=A:1234    iss_country=GB    origin=JFK    destination=LHR    dep_date=20190912
    ...    app_id=MyCWT_Mobile
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    #OAG Data Same Origin-Destination
    Generate Carriers OAG Data    CARRIERS::JFK::LHR,20191201::20190912::AA;20191201::20190712::AE;20190912::20190712::AI;20190911::20180912::AM;20191201::20190913::AQ;20191201::20190912::AU;20191201::20190912::AY;20191201::20190912::A3
    # Multiple Matching AP Data With Origin Airport
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AA    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=2
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AB    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=C_GB    ap_score=0.2
    ...    ap_policy_order=2
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AC    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=R_EUR    ap_score=0.3
    ...    ap_policy_order=2
    Generate Test Variables And Data For Agency Preferences    row_id=1    ap_carrier_code=AD    ap_iss_country=C_GB    ap_origin=A_JFK    ap_destination=G_YYYY    ap_score=0.4
    ...    ap_policy_order=2
    # Multiple Matching AP Data With Origin Country
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AE    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=A_LHR    ap_score=0.5
    ...    ap_policy_order=3
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AF    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=C_GB    ap_score=0.6
    ...    ap_policy_order=3
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AG    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=R_EUR    ap_score=0.7
    ...    ap_policy_order=3
    Generate Test Variables And Data For Agency Preferences    row_id=2    ap_carrier_code=AH    ap_iss_country=C_GB    ap_origin=C_US    ap_destination=G_YYYY    ap_score=0.8
    ...    ap_policy_order=3
    # Multiple Matching AP Data With Origin Region
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AI    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=A_LHR    ap_score=0.9
    ...    ap_policy_order=4
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AJ    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=C_GB    ap_score=1.10
    ...    ap_policy_order=4
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AK    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=R_EUR    ap_score=1.20
    ...    ap_policy_order=4
    Generate Test Variables And Data For Agency Preferences    row_id=3    ap_carrier_code=AL    ap_iss_country=C_GB    ap_origin=R_NAM    ap_destination=G_YYYY    ap_score=1.30
    ...    ap_policy_order=4
    # Multiple Matching AP Data With Origin Global
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AM    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=A_LHR    ap_score=1.40
    ...    ap_policy_order=5
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AN    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=C_GB    ap_score=1.50
    ...    ap_policy_order=5
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AO    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=R_EUR    ap_score=1.60
    ...    ap_policy_order=5
    Generate Test Variables And Data For Agency Preferences    row_id=4    ap_carrier_code=AP    ap_iss_country=C_GB    ap_origin=G_YYYY    ap_destination=G_YYYY    ap_score=1.70
    ...    ap_policy_order=5
    # Multiple Matching AP Data With Origin Airport And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AQ    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=1.80
    ...    ap_policy_order=6
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AR    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=C_GB    ap_score=1.90
    ...    ap_policy_order=6
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AS    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=R_EUR    ap_score=2.00
    ...    ap_policy_order=6
    Generate Test Variables And Data For Agency Preferences    row_id=5    ap_carrier_code=AT    ap_iss_country=R_EUR    ap_origin=A_JFK    ap_destination=G_YYYY    ap_score=2.10
    ...    ap_policy_order=6
    # Multiple Matching AP Data With Origin Country And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AU    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=A_LHR    ap_score=2.20
    ...    ap_policy_order=7
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AV    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=C_GB    ap_score=2.30
    ...    ap_policy_order=7
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AW    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=R_EUR    ap_score=2.40
    ...    ap_policy_order=7
    Generate Test Variables And Data For Agency Preferences    row_id=6    ap_carrier_code=AX    ap_iss_country=R_EUR    ap_origin=C_US    ap_destination=G_YYYY    ap_score=2.50
    ...    ap_policy_order=7
    # Multiple Matching AP Data With Origin Region And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=AY    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=A_LHR    ap_score=2.60
    ...    ap_policy_order=8
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=AZ    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=C_GB    ap_score=2.70
    ...    ap_policy_order=8
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=A1    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=R_EUR    ap_score=2.80
    ...    ap_policy_order=8
    Generate Test Variables And Data For Agency Preferences    row_id=7    ap_carrier_code=A2    ap_iss_country=R_EUR    ap_origin=R_NAM    ap_destination=G_YYYY    ap_score=2.90
    ...    ap_policy_order=8
    # Multiple Matching AP Data With Origin Global And POS Region
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A3    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=A_LHR    ap_score=3.00
    ...    ap_policy_order=9
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A4    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=C_GB    ap_score=3.10
    ...    ap_policy_order=9
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A5    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=R_EUR    ap_score=3.20
    ...    ap_policy_order=9
    Generate Test Variables And Data For Agency Preferences    row_id=8    ap_carrier_code=A6    ap_iss_country=R_EUR    ap_origin=G_YYYY    ap_destination=G_YYYY    ap_score=3.30
    ...    ap_policy_order=9
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AA    cp_origin=A_JFK    cp_destination=A_LHR    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AB    cp_origin=A_JFK    cp_destination=CI_LON    cp_policy_order=2
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AC    cp_origin=CI_NYC    cp_destination=A_LHR    cp_policy_order=3
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AD    cp_origin=A_JFK    cp_destination=C_GB    cp_policy_order=4
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AE    cp_origin=C_US    cp_destination=A_LHR    cp_policy_order=5
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AF    cp_origin=A_JFK    cp_destination=SR_EUROP    cp_policy_order=6
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AG    cp_origin=SR_NAMER    cp_destination=A_LHR    cp_policy_order=7
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AH    cp_origin=A_JFK    cp_destination=R_EMEA    cp_policy_order=8
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AI    cp_origin=R_NORAM    cp_destination=A_LHR    cp_policy_order=9
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AJ    cp_origin=A_JFK    cp_destination=G_YYYY    cp_policy_order=10
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AK    cp_origin=G_YYYY    cp_destination=A_LHR    cp_policy_order=11
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AL    cp_origin=CI_NYC    cp_destination=CI_LON    cp_policy_order=12
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AM    cp_origin=CI_NYC    cp_destination=C_GB    cp_policy_order=13
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AN    cp_origin=C_US    cp_destination=CI_LON    cp_policy_order=14
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AO    cp_origin=CI_NYC    cp_destination=SR_EUROP    cp_policy_order=15
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AP    cp_origin=SR_NAMER    cp_destination=CI_LON    cp_policy_order=16
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AQ    cp_origin=CI_NYC    cp_destination=R_EMEA    cp_policy_order=17
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AR    cp_origin=R_NORAM    cp_destination=CI_LON    cp_policy_order=18
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AS    cp_origin=CI_NYC    cp_destination=G_YYYY    cp_policy_order=19
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AT    cp_origin=G_YYYY    cp_destination=CI_LON    cp_policy_order=20
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AU    cp_origin=C_US    cp_destination=C_GB    cp_policy_order=21
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AV    cp_origin=C_US    cp_destination=SR_EUROP    cp_policy_order=22
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AW    cp_origin=SR_NAMER    cp_destination=C_GB    cp_policy_order=23
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AX    cp_origin=C_US    cp_destination=R_EMEA    cp_policy_order=24
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AY    cp_origin=R_NORAM    cp_destination=C_GB    cp_policy_order=25
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=AZ    cp_origin=C_US    cp_destination=G_YYYY    cp_policy_order=26
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A0    cp_origin=G_YYYY    cp_destination=C_GB    cp_policy_order=27
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A1    cp_origin=SR_NAMER    cp_destination=SR_EUROP    cp_policy_order=28
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A2    cp_origin=SR_NAMER    cp_destination=R_EMEA    cp_policy_order=29
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A3    cp_origin=R_NORAM    cp_destination=SR_EUROP    cp_policy_order=30
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A4    cp_origin=SR_NAMER    cp_destination=G_YYYY    cp_policy_order=31
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A5    cp_origin=G_YYYY    cp_destination=SR_EUROP    cp_policy_order=32
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A6    cp_origin=R_NORAM    cp_destination=R_EMEA    cp_policy_order=33
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A7    cp_origin=R_NORAM    cp_destination=G_YYYY    cp_policy_order=34
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A8    cp_origin=G_YYYY    cp_destination=R_EMEA    cp_policy_order=35
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=A:1234    cp_carrier_code=A9    cp_origin=G_YYYY    cp_destination=G_YYYY    cp_policy_order=36
    #Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Comment    Calculate And Compare Dynamic Scores    8    0.3    apScore
    Comment    Calculate And Compare Dynamic Scores    36    0.3    cpScore
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    {"version":"${exp_version}","experimentGroupTypeCode":"DATASET_${prefix}","result":{"score":[{"carrierCode":"AA","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":1,"apScore":0.3,"cpScore":0.3,"totalScore":0.6},{"carrierCode":"AB","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":0.972972972972973,"apScore":0.3,"cpScore":0.2918919,"totalScore":0.5918919},{"carrierCode":"AC","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":0.9459459459459459,"apScore":0.3,"cpScore":0.2837838,"totalScore":0.5837838},{"carrierCode":"AD","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":0.9189189189189189,"apScore":0.3,"cpScore":0.27567568,"totalScore":0.5756757},{"carrierCode":"AE","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8918918918918919,"apScore":0.26666668,"cpScore":0.26756757,"totalScore":0.5342343},{"carrierCode":"AF","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8648648648648649,"apScore":0.26666668,"cpScore":0.25945947,"totalScore":0.52612615},{"carrierCode":"AG","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8378378378378378,"apScore":0.26666668,"cpScore":0.25135136,"totalScore":0.518018},{"carrierCode":"AH","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8108108108108107,"apScore":0.26666668,"cpScore":0.24324325,"totalScore":0.5099099},{"carrierCode":"AI","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7837837837837838,"apScore":0.23333335,"cpScore":0.23513515,"totalScore":0.4684685},{"carrierCode":"AJ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7567567567567568,"apScore":0.23333335,"cpScore":0.22702704,"totalScore":0.4603604},{"carrierCode":"AK","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7297297297297297,"apScore":0.23333335,"cpScore":0.21891892,"totalScore":0.45225227},{"carrierCode":"AL","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7027027027027026,"apScore":0.23333335,"cpScore":0.21081083,"totalScore":0.4441442},{"carrierCode":"AM","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.6756756756756757,"apScore":0.20000002,"cpScore":0.20270272,"totalScore":0.40270275},{"carrierCode":"AN","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.6486486486486487,"apScore":0.20000002,"cpScore":0.19459459,"totalScore":0.3945946},{"carrierCode":"AO","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.6216216216216216,"apScore":0.20000002,"cpScore":0.18648648,"totalScore":0.3864865},{"carrierCode":"AP","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.5945945945945945,"apScore":0.20000002,"cpScore":0.17837839,"totalScore":0.3783784},{"carrierCode":"AQ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.5675675675675675,"apScore":0.16666669,"cpScore":0.17027028,"totalScore":0.33693695},{"carrierCode":"AR","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.5405405405405406,"apScore":0.16666669,"cpScore":0.16216215,"totalScore":0.32882884},{"carrierCode":"AS","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.5135135135135135,"apScore":0.16666669,"cpScore":0.15405406,"totalScore":0.32072073},{"carrierCode":"AT","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.4864864864864865,"apScore":0.16666669,"cpScore":0.14594595,"totalScore":0.31261265},{"carrierCode":"AU","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.45945945945945943,"apScore":0.13333334,"cpScore":0.13783784,"totalScore":0.27117118},{"carrierCode":"AV","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.43243243243243246,"apScore":0.13333334,"cpScore":0.12972973,"totalScore":0.26306307},{"carrierCode":"AW","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.4054054054054054,"apScore":0.13333334,"cpScore":0.12162162,"totalScore":0.25495496},{"carrierCode":"AX","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.3783783783783784,"apScore":0.13333334,"cpScore":0.11351352,"totalScore":0.24684685},{"carrierCode":"AY","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.3513513513513513,"apScore":0.10000001,"cpScore":0.10540541,"totalScore":0.20540541},{"carrierCode":"AZ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.32432432432432434,"apScore":0.10000001,"cpScore":0.097297296,"totalScore":0.1972973},{"carrierCode":"A0","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.29729729729729726,"apScore":0.0,"cpScore":0.089189194,"totalScore":0.089189194},{"carrierCode":"A1","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.2702702702702703,"apScore":0.10000001,"cpScore":0.08108108,"totalScore":0.18108109},{"carrierCode":"A2","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.2432432432432432,"apScore":0.10000001,"cpScore":0.072972976,"totalScore":0.17297298},{"carrierCode":"A3","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.21621621621621623,"apScore":0.06666667,"cpScore":0.06486487,"totalScore":0.13153154},{"carrierCode":"A4","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.18918918918918914,"apScore":0.06666667,"cpScore":0.05675676,"totalScore":0.12342343},{"carrierCode":"A5","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.16216216216216217,"apScore":0.06666667,"cpScore":0.048648648,"totalScore":0.11531532},{"carrierCode":"A6","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.1351351351351351,"apScore":0.06666667,"cpScore":0.04054054,"totalScore":0.10720721},{"carrierCode":"A7","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.10810810810810811,"apScore":0.0,"cpScore":0.032432433,"totalScore":0.032432433},{"carrierCode":"A8","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.08108108108108103,"apScore":0.0,"cpScore":0.024324324,"totalScore":0.024324324},{"carrierCode":"A9","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.05405405405405406,"apScore":0.0,"cpScore":0.016216217,"totalScore":0.016216217}],"travelerPreference":${${trv_guid}_trv_data},"boost":{"consumer":"MyCWT_Mobile","tpBoost":0.5,"cpBoost":0.3,"apBoost":0.3,"others":{"Factor1":"test"}},"meta":${tp_meta_data}}}
    Verify The Personalization Score When Version Is V2    {"version":"${exp_version}","experimentGroupTypeCode":"${prefix}","offlineAlgorithm":"${offline_algorithm}","onlineAlgorithm":"${online_algorithm}","personalizationApplied": ${pers_applied},"systemPersonalized":false,"result":{"score":[{"carrierCode":"AA","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":1,"cpPolicyOrder":1,"cpDerivedPolicyOrder":1,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.3,"totalScore":0.6},{"carrierCode":"AB","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":0.972972972972973,"cpPolicyOrder":2,"cpDerivedPolicyOrder":2,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.2918919,"totalScore":0.5918919},{"carrierCode":"AC","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":0.9459459459459459,"cpPolicyOrder":3,"cpDerivedPolicyOrder":3,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.2837838,"totalScore":0.5837838},{"carrierCode":"AD","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":1,"cpValue":0.9189189189189189,"cpPolicyOrder":4,"cpDerivedPolicyOrder":4,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.27567568,"totalScore":0.5756757},{"carrierCode":"AE","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8918918918918919,"cpPolicyOrder":5,"cpDerivedPolicyOrder":5,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.26756757,"totalScore":0.5342343},{"carrierCode":"AF","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8648648648648649,"cpPolicyOrder":6,"cpDerivedPolicyOrder":6,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.25945947,"totalScore":0.52612615},{"carrierCode":"AG","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8378378378378378,"cpPolicyOrder":7,"cpDerivedPolicyOrder":7,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.25135136,"totalScore":0.518018},{"carrierCode":"AH","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.8888888888888888,"cpValue":0.8108108108108107,"cpPolicyOrder":8,"cpDerivedPolicyOrder":8,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.24324325,"totalScore":0.5099099},{"carrierCode":"AI","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7837837837837838,"cpPolicyOrder":9,"cpDerivedPolicyOrder":9,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.23513515,"totalScore":0.4684685},{"carrierCode":"AJ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7567567567567568,"cpPolicyOrder":10,"cpDerivedPolicyOrder":10,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.22702704,"totalScore":0.4603604},{"carrierCode":"AK","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7297297297297297,"cpPolicyOrder":11,"cpDerivedPolicyOrder":11,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.21891892,"totalScore":0.45225227},{"carrierCode":"AL","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.7777777777777778,"cpValue":0.7027027027027026,"cpPolicyOrder":12,"cpDerivedPolicyOrder":12,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.21081083,"totalScore":0.4441442},{"carrierCode":"AM","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.6756756756756757,"cpPolicyOrder":13,"cpDerivedPolicyOrder":13,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.20270272,"totalScore":0.40270275},{"carrierCode":"AN","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.6486486486486487,"cpPolicyOrder":14,"cpDerivedPolicyOrder":14,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.19459459,"totalScore":0.3945946},{"carrierCode":"AO","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.6216216216216216,"cpPolicyOrder":15,"cpDerivedPolicyOrder":15,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.18648648,"totalScore":0.3864865},{"carrierCode":"AP","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.6666666666666667,"cpValue":0.5945945945945945,"cpPolicyOrder":16,"cpDerivedPolicyOrder":16,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.17837839,"totalScore":0.3783784},{"carrierCode":"AQ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.5675675675675675,"cpPolicyOrder":17,"cpDerivedPolicyOrder":17,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.17027028,"totalScore":0.33693695},{"carrierCode":"AR","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.5405405405405406,"cpPolicyOrder":18,"cpDerivedPolicyOrder":18,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.16216215,"totalScore":0.32882884},{"carrierCode":"AS","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.5135135135135135,"cpPolicyOrder":19,"cpDerivedPolicyOrder":19,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.15405406,"totalScore":0.32072073},{"carrierCode":"AT","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.5555555555555556,"cpValue":0.4864864864864865,"cpPolicyOrder":20,"cpDerivedPolicyOrder":20,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.14594595,"totalScore":0.31261265},{"carrierCode":"AU","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.45945945945945943,"cpPolicyOrder":21,"cpDerivedPolicyOrder":21,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.13783784,"totalScore":0.27117118},{"carrierCode":"AV","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.43243243243243246,"cpPolicyOrder":22,"cpDerivedPolicyOrder":22,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.12972973,"totalScore":0.26306307},{"carrierCode":"AW","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.4054054054054054,"cpPolicyOrder":23,"cpDerivedPolicyOrder":23,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.12162162,"totalScore":0.25495496},{"carrierCode":"AX","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.4444444444444444,"cpValue":0.3783783783783784,"cpPolicyOrder":24,"cpDerivedPolicyOrder":24,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.11351352,"totalScore":0.24684685},{"carrierCode":"AY","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.3513513513513513,"cpPolicyOrder":25,"cpDerivedPolicyOrder":25,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.10540541,"totalScore":0.20540541},{"carrierCode":"AZ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.32432432432432434,"cpPolicyOrder":26,"cpDerivedPolicyOrder":26,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.097297296,"totalScore":0.1972973},{"carrierCode":"A0","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.29729729729729726,"cpPolicyOrder":27,"cpDerivedPolicyOrder":27,"apScore":0.0,"cpScore":0.089189194,"totalScore":0.089189194},{"carrierCode":"A1","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.2702702702702703,"cpPolicyOrder":28,"cpDerivedPolicyOrder":28,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.08108108,"totalScore":0.18108109},{"carrierCode":"A2","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.33333333333333337,"cpValue":0.2432432432432432,"cpPolicyOrder":29,"cpDerivedPolicyOrder":29,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.072972976,"totalScore":0.17297298},{"carrierCode":"A3","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.21621621621621623,"cpPolicyOrder":30,"cpDerivedPolicyOrder":30,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.06486487,"totalScore":0.13153154},{"carrierCode":"A4","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.18918918918918914,"cpPolicyOrder":31,"cpDerivedPolicyOrder":31,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.05675676,"totalScore":0.12342343},{"carrierCode":"A5","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.16216216216216217,"cpPolicyOrder":32,"cpDerivedPolicyOrder":32,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.048648648,"totalScore":0.11531532},{"carrierCode":"A6","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0.2222222222222222,"cpValue":0.1351351351351351,"cpPolicyOrder":33,"cpDerivedPolicyOrder":33,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.04054054,"totalScore":0.10720721},{"carrierCode":"A7","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.10810810810810811,"cpPolicyOrder":34,"cpDerivedPolicyOrder":34,"apScore":0.0,"cpScore":0.032432433,"totalScore":0.032432433},{"carrierCode":"A8","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.08108108108108103,"cpPolicyOrder":35,"cpDerivedPolicyOrder":35,"apScore":0.0,"cpScore":0.024324324,"totalScore":0.024324324},{"carrierCode":"A9","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.05405405405405406,"cpPolicyOrder":36,"cpDerivedPolicyOrder":36,"apScore":0.0,"cpScore":0.016216217,"totalScore":0.016216217}],"travelerPreference":${${trv_guid}_trv_data},"boost":{"tpBoost":0.5,"cpBoost":0.3,"apBoost":0.3,"priceBoost":${price},"durationBoost":${duration},"numStopsBoost":${num_stops},"flightTimeBoost":${flight_time}}}}
    Verify The Personalization Score When Version Is V2.2    {"version":"${exp_version}","experimentGroupTypeCode":"${prefix}","offlineAlgorithm":"${offline_algorithm}","onlineAlgorithm":"${online_algorithm}","personalizationApplied":${pers_applied},"systemPersonalized":false,"result":{"score":[{"carrierCode":"AA","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":1,"cpValue":1,"cpPolicyOrder":1,"cpDerivedPolicyOrder":1,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.3,"totalScore":0.6},{"carrierCode":"AB","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":1,"cpValue":0.972972972972973,"cpPolicyOrder":2,"cpDerivedPolicyOrder":2,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.2918919,"totalScore":0.5918919},{"carrierCode":"AC","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":1,"cpValue":0.9459459459459459,"cpPolicyOrder":3,"cpDerivedPolicyOrder":3,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.2837838,"totalScore":0.5837838},{"carrierCode":"AD","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":1,"cpValue":0.9189189189189189,"cpPolicyOrder":4,"cpDerivedPolicyOrder":4,"apPolicyOrder":2,"apDerivedPolicyOrder":1,"apScore":0.3,"cpScore":0.27567568,"totalScore":0.5756757},{"carrierCode":"AE","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.8888888888888888,"cpValue":0.8918918918918919,"cpPolicyOrder":5,"cpDerivedPolicyOrder":5,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.26756757,"totalScore":0.5342343},{"carrierCode":"AF","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.8888888888888888,"cpValue":0.8648648648648649,"cpPolicyOrder":6,"cpDerivedPolicyOrder":6,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.25945947,"totalScore":0.52612615},{"carrierCode":"AG","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.8888888888888888,"cpValue":0.8378378378378378,"cpPolicyOrder":7,"cpDerivedPolicyOrder":7,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.25135136,"totalScore":0.518018},{"carrierCode":"AH","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.8888888888888888,"cpValue":0.8108108108108107,"cpPolicyOrder":8,"cpDerivedPolicyOrder":8,"apPolicyOrder":3,"apDerivedPolicyOrder":2,"apScore":0.26666668,"cpScore":0.24324325,"totalScore":0.5099099},{"carrierCode":"AI","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.7777777777777778,"cpValue":0.7837837837837838,"cpPolicyOrder":9,"cpDerivedPolicyOrder":9,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.23513515,"totalScore":0.4684685},{"carrierCode":"AJ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.7777777777777778,"cpValue":0.7567567567567568,"cpPolicyOrder":10,"cpDerivedPolicyOrder":10,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.22702704,"totalScore":0.4603604},{"carrierCode":"AK","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.7777777777777778,"cpValue":0.7297297297297297,"cpPolicyOrder":11,"cpDerivedPolicyOrder":11,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.21891892,"totalScore":0.45225227},{"carrierCode":"AL","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.7777777777777778,"cpValue":0.7027027027027026,"cpPolicyOrder":12,"cpDerivedPolicyOrder":12,"apPolicyOrder":4,"apDerivedPolicyOrder":3,"apScore":0.23333335,"cpScore":0.21081083,"totalScore":0.4441442},{"carrierCode":"AM","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.6666666666666667,"cpValue":0.6756756756756757,"cpPolicyOrder":13,"cpDerivedPolicyOrder":13,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.20270272,"totalScore":0.40270275},{"carrierCode":"AN","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.6666666666666667,"cpValue":0.6486486486486487,"cpPolicyOrder":14,"cpDerivedPolicyOrder":14,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.19459459,"totalScore":0.3945946},{"carrierCode":"AO","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.6666666666666667,"cpValue":0.6216216216216216,"cpPolicyOrder":15,"cpDerivedPolicyOrder":15,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.18648648,"totalScore":0.3864865},{"carrierCode":"AP","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.6666666666666667,"cpValue":0.5945945945945945,"cpPolicyOrder":16,"cpDerivedPolicyOrder":16,"apPolicyOrder":5,"apDerivedPolicyOrder":4,"apScore":0.20000002,"cpScore":0.17837839,"totalScore":0.3783784},{"carrierCode":"AQ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.5555555555555556,"cpValue":0.5675675675675675,"cpPolicyOrder":17,"cpDerivedPolicyOrder":17,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.17027028,"totalScore":0.33693695},{"carrierCode":"AR","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.5555555555555556,"cpValue":0.5405405405405406,"cpPolicyOrder":18,"cpDerivedPolicyOrder":18,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.16216215,"totalScore":0.32882884},{"carrierCode":"AS","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.5555555555555556,"cpValue":0.5135135135135135,"cpPolicyOrder":19,"cpDerivedPolicyOrder":19,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.15405406,"totalScore":0.32072073},{"carrierCode":"AT","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.5555555555555556,"cpValue":0.4864864864864865,"cpPolicyOrder":20,"cpDerivedPolicyOrder":20,"apPolicyOrder":6,"apDerivedPolicyOrder":5,"apScore":0.16666669,"cpScore":0.14594595,"totalScore":0.31261265},{"carrierCode":"AU","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.4444444444444444,"cpValue":0.45945945945945943,"cpPolicyOrder":21,"cpDerivedPolicyOrder":21,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.13783784,"totalScore":0.27117118},{"carrierCode":"AV","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.4444444444444444,"cpValue":0.43243243243243246,"cpPolicyOrder":22,"cpDerivedPolicyOrder":22,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.12972973,"totalScore":0.26306307},{"carrierCode":"AW","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.4444444444444444,"cpValue":0.4054054054054054,"cpPolicyOrder":23,"cpDerivedPolicyOrder":23,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.12162162,"totalScore":0.25495496},{"carrierCode":"AX","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.4444444444444444,"cpValue":0.3783783783783784,"cpPolicyOrder":24,"cpDerivedPolicyOrder":24,"apPolicyOrder":7,"apDerivedPolicyOrder":6,"apScore":0.13333334,"cpScore":0.11351352,"totalScore":0.24684685},{"carrierCode":"AY","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.33333333333333337,"cpValue":0.3513513513513513,"cpPolicyOrder":25,"cpDerivedPolicyOrder":25,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.10540541,"totalScore":0.20540541},{"carrierCode":"AZ","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.33333333333333337,"cpValue":0.32432432432432434,"cpPolicyOrder":26,"cpDerivedPolicyOrder":26,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.097297296,"totalScore":0.1972973},{"carrierCode":"A0","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.29729729729729726,"cpPolicyOrder":27,"cpDerivedPolicyOrder":27,"apScore":0.0,"cpScore":0.089189194,"totalScore":0.089189194},{"carrierCode":"A1","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.33333333333333337,"cpValue":0.2702702702702703,"cpPolicyOrder":28,"cpDerivedPolicyOrder":28,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.08108108,"totalScore":0.18108109},{"carrierCode":"A2","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.33333333333333337,"cpValue":0.2432432432432432,"cpPolicyOrder":29,"cpDerivedPolicyOrder":29,"apPolicyOrder":8,"apDerivedPolicyOrder":7,"apScore":0.10000001,"cpScore":0.072972976,"totalScore":0.17297298},{"carrierCode":"A3","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.2222222222222222,"cpValue":0.21621621621621623,"cpPolicyOrder":30,"cpDerivedPolicyOrder":30,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.06486487,"totalScore":0.13153154},{"carrierCode":"A4","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.2222222222222222,"cpValue":0.18918918918918914,"cpPolicyOrder":31,"cpDerivedPolicyOrder":31,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.05675676,"totalScore":0.12342343},{"carrierCode":"A5","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.2222222222222222,"cpValue":0.16216216216216217,"cpPolicyOrder":32,"cpDerivedPolicyOrder":32,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.048648648,"totalScore":0.11531532},{"carrierCode":"A6","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","validatingCarrierCode":"AA","cabinClass":"F","apValue":0.2222222222222222,"cpValue":0.1351351351351351,"cpPolicyOrder":33,"cpDerivedPolicyOrder":33,"apPolicyOrder":9,"apDerivedPolicyOrder":8,"apScore":0.06666667,"cpScore":0.04054054,"totalScore":0.10720721},{"carrierCode":"A7","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.10810810810810811,"cpPolicyOrder":34,"cpDerivedPolicyOrder":34,"apScore":0.0,"cpScore":0.032432433,"totalScore":0.032432433},{"carrierCode":"A8","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.08108108108108103,"cpPolicyOrder":35,"cpDerivedPolicyOrder":35,"apScore":0.0,"cpScore":0.024324324,"totalScore":0.024324324},{"carrierCode":"A9","origin":"${origin}","destination":"${destination}","issuingCountry":"${iss_country}","apValue":0,"cpValue":0.05405405405405406,"cpPolicyOrder":36,"cpDerivedPolicyOrder":36,"apScore":0.0,"cpScore":0.016216217,"totalScore":0.016216217}],"travelerPreference":${${trv_guid}_trv_data},"boost":{"tpBoost":0.5,"cpBoost":0.3,"apBoost":0.3,"priceBoost":${price},"durationBoost":${duration},"numStopsBoost":${num_stops},"flightTimeBoost":${flight_time}}}}
    [Teardown]    Delete All Redis Keys Using Pattern    CARRIERS::*

FNC_079 Score Is Succesfully Retrieved With OAG Data (AP, CP) Where Origin-Destination Code Type Is City (With Hierarchy) And OAG Is True In Feature (Full OAG)
    [Tags]    not-ready
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=true    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Data For Traveler Preference 2    V1,C:8901
    Generate Test Variables For Personalization Score    trv_guid=C:8901    csu_guid=C:1234    iss_country=JP    origin=TYO    destination=SFY    dep_date=20190912
    ...    app_id=Desktop_Amadeus    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    #OAG Data Same Origin-Destination
    Generate Carriers OAG Data    CARRIERS::HND::CEF,20191201::20190912::AB|CARRIERS::NRT::ZSF,20191201::20190912::AE|CARRIERS::OKO::ZSF,20191201::20190912::AD|CARRIERS::HND::ZSF,20191201::20190912::AC|CARRIERS::NRT::CEF,20191201::20190912::AA|CARRIERS::OKO::CEF,20191201::20190912::AF
    # Multiple Matching AP Data
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AC    ap_origin=A_HND    ap_destination=R_NAM    ap_score=0.6
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AE    ap_origin=A_NRT    ap_destination=G_YYYY    ap_score=0.8
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AF    ap_origin=G_YYYY    ap_destination=G_YYYY    ap_score=0.9
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AB    ap_origin=C_JP    ap_destination=A_CEF    ap_score=0.5
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AA    cp_origin=CI_TYO    cp_destination=A_CEF    cp_score=0.4    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AB    cp_origin=A_NRT    cp_destination=C_US    cp_score=0.5    cp_policy_order=2
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AD    cp_origin=A_OKO    cp_destination=R_NORAM    cp_score=0.7    cp_policy_order=3
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AE    cp_origin=G_YYYY    cp_destination=A_ZSF    cp_score=0.8    cp_policy_order=4
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.7    boost_cp=1
    #Non-Mathing CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=D:1234    cp_carrier_code=AC    cp_origin=SR_ASIA    cp_destination=A_CEF    cp_score=0.6
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=D:1234    cp_carrier_code=AF    cp_origin=G_YYYY    cp_destination=G_YYYY    cp_score=0.9
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_079_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_079_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_079_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_079_v3_results.json
    [Teardown]    Delete All Redis Keys Using Pattern    CARRIERS::*

FNC_080 Score Is Succesfully Retrieved With OAG Data (AP, CP) Where Origin-Destination Code Type Is City (With Hierarchy) And OAG Is True In Feature (Partial OAG)
    [Tags]    not-ready
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=true    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Data For Traveler Preference 2    V1,C:8901
    Generate Test Variables For Personalization Score    trv_guid=C:8901    csu_guid=C:1234    iss_country=JP    origin=TYO    destination=SFY    dep_date=20190912
    ...    app_id=Desktop_Amadeus    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    #OAG Data Same Origin-Destination
    Generate Carriers OAG Data    CARRIERS::HND::CEF,20191201::20190912::AB|CARRIERS::NRT::ZSF,20191201::20190912::AE|CARRIERS::OKO::ZSF,20191201::20190912::AD
    # Multiple Matching AP Data
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AC    ap_origin=A_HND    ap_destination=R_NAM    ap_score=0.6
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AE    ap_origin=A_NRT    ap_destination=G_YYYY    ap_score=0.8
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AF    ap_origin=G_YYYY    ap_destination=G_YYYY    ap_score=0.9
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AB    ap_origin=C_JP    ap_destination=A_CEF    ap_score=0.5
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AA    cp_origin=CI_TYO    cp_destination=A_CEF    cp_score=0.4    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AB    cp_origin=A_NRT    cp_destination=C_US    cp_score=0.5    cp_policy_order=2
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AD    cp_origin=A_OKO    cp_destination=R_NORAM    cp_score=0.7    cp_policy_order=3
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AE    cp_origin=G_YYYY    cp_destination=A_ZSF    cp_score=0.8    cp_policy_order=4
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.7    boost_cp=1
    #Non-Mathing CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=D:1234    cp_carrier_code=AC    cp_origin=SR_ASIA    cp_destination=A_CEF    cp_score=0.6
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=D:1234    cp_carrier_code=AF    cp_origin=G_YYYY    cp_destination=G_YYYY    cp_score=0.9
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_080_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_080_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_080_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_080_v3_results.json
    [Teardown]    Delete All Redis Keys Using Pattern    CARRIERS::*

FNC_081 Verify The Eligibility And Score With OAG Data (AP, CP) When Origin-Destination Code Type Is City
    [Tags]    not-ready
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,C:8901
    Delete All Redis Keys Using Pattern    RULES*
    Generate Test Data For Features    api_version_feature=V2    app_id=Desktop_Amadeus    oag_value=true    cp_pass=true    default_tp=false
    Generate Test Data For Features    api_version_feature=V1    app_id=Desktop_Amadeus    oag_value=true    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Add Rules In Redis    .*?::.*?::.*?::.*?::.*?::.*?::.*?::OKO::.*?::.*?::CEF::.*?::ON|.*?::.*?::.*?::.*?::.*?::.*?::.*?::HND::.*?::.*?::.*?::.*?::ON|.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::CEF::.*?::ON|.*?::.*?::.*?::.*?::.*?::.*?::.*?::NRT::.*?::.*?::ZSF::.*?::ON
    #OAG Data Same Origin-Destination
    Generate Carriers OAG Data    CARRIERS::HND::CEF,20191201::20190912::AC|CARRIERS::NRT::ZSF,20191201::20190912::AE|CARRIERS::OKO::CEF,20191201::20190912::AA
    Generate Test Variables For Personalization Score    trv_guid=C:8901    csu_guid=C:1234    iss_country=JP    origin=TYO    destination=SFY    dep_date=20191201
    ...    app_id=Desktop_Amadeus    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=Desktop_Amadeus
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=DEFAULT
    # Multiple Matching AP Data
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AA    ap_origin=A_OKO    ap_destination=A_CEF    ap_score=0.4
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AB    ap_origin=A_NRT    ap_destination=A_CEF    ap_score=0.5
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AC    ap_origin=A_HND    ap_destination=A_CEF    ap_score=0.6
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AX    ap_origin=A_HND    ap_destination=A_CEF    ap_score=0.6
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AD    ap_origin=A_OKO    ap_destination=A_ZSF    ap_score=0.7
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AE    ap_origin=A_NRT    ap_destination=A_ZSF    ap_score=0.8
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AY    ap_origin=A_NRT    ap_destination=A_ZSF    ap_score=0.8
    Generate Test Variables And Data For Agency Preferences    ap_carrier_code=AF    ap_origin=A_HND    ap_destination=A_ZSF    ap_score=0.9
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AA    cp_origin=A_OKO    cp_destination=A_CEF    cp_score=0.4
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AZ    cp_origin=A_OKO    cp_destination=A_CEF    cp_score=0.4
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AB    cp_origin=A_NRT    cp_destination=A_CEF    cp_score=0.5
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AC    cp_origin=A_HND    cp_destination=A_CEF    cp_score=0.6
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AD    cp_origin=A_OKO    cp_destination=A_ZSF    cp_score=0.7
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AE    cp_origin=A_NRT    cp_destination=A_ZSF    cp_score=0.8
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AF    cp_origin=A_HND    cp_destination=A_ZSF    cp_score=0.9
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.7    boost_cp=0.4
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_081_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_081_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_081_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_081_v3_results.json
    [Teardown]    Delete All Redis Keys Using Pattern    CARRIERS::*

FNC_082 Score Is Successfully Retrieved When Updated Reference Key For AP, CP,TP And Boost Is Available
    [Documentation]    *For V3 response non-matching traveler data with ap and cp*
    [Tags]    V1    V2    V2.2    V3
    [Setup]    Flush All Redis Keys
    Initialize Test Data For Score API
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986    ref_key=1
    Generate Test Data For Traveler Preference 2    V1,A:1234    ref_key=2
    Generate Test Variables For Personalization Score    trv_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20181201    csu_guid=A:1234
    Create Test Data For Metadata
    Create TP Meta Data
    # AP Data With Ref Key 1
    Generate Test Variables And Data For Agency Preferences    ref_key=1    ap_carrier_code=AA    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    Generate Test Variables And Data For Agency Preferences    ref_key=1    ap_carrier_code=AB    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    # AP Data With Ref Key 2
    Generate Test Variables And Data For Agency Preferences    ref_key=2    ap_carrier_code=BA    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=1    row_id=1
    Generate Test Variables And Data For Agency Preferences    ref_key=2    ap_carrier_code=BB    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=2    row_id=2
    # CP Data With Ref Key 1
    Generate Test Variables And Data For Client Preferences    ref_key=1    cp_csu_guid=A:1234    cp_carrier_code=AA    cp_origin=A_JFK    cp_destination=A_LHR    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    ref_key=1    cp_csu_guid=A:1234    cp_carrier_code=AB    cp_origin=A_JFK    cp_destination=CI_LON    cp_policy_order=2
    # CP Data With Ref Key 2
    Generate Test Variables And Data For Client Preferences    ref_key=2    cp_csu_guid=A:1234    cp_carrier_code=BA    cp_origin=A_JFK    cp_destination=A_LHR    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    ref_key=2    cp_csu_guid=A:1234    cp_carrier_code=BB    cp_origin=A_JFK    cp_destination=CI_LON    cp_policy_order=2
    # Boost Data With Ref Key 1
    Generate Test Variables And Data For Boost    boost_cp=0.6    boost_ap=0.3    ref_key=1
    # Boost Data With Ref Key 2
    Generate Test Variables And Data For Boost    boost_cp=0.6    boost_ap=0.5    ref_key=2
    Create Test Data For Metadata    ap_ref_key=2    cp_ref_key=2    tp_ref_key=2    boost_ref_key=2
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_082_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_082_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_082_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_082_v3_results.json

FNC_083 Score Is Successfully Retrieved When Different Version Of Algorithm And AP,CP,TP And Boost Data
    [Documentation]    *For V3 response, matching and non-matching travelar carrier code*
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Create TP Meta Data
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=true
    Clear Cache    personalizationConfig
    Get Authorization Token
    # Request
    Generate Test Variables For Personalization Score    trv_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20181201    csu_guid=A:1234
    Create Test Data For Metadata    group=A    api_version=v2    ap_version=v2.2    cp_version=v2    tp_version=v2    boost_version=v1
    ...    ap_version_override=true
    Create Test Data For Metadata    group=A    api_version=v2.2    ap_version=v2.2    cp_version=v2    tp_version=v2    boost_version=v1
    ...    ap_version_override=true
    Create Test Data For Metadata    group=A    api_version=v3    ap_version=v2.2    cp_version=v2    tp_version=v2    boost_version=v1
    ...    ap_version_override=true
    Generate Test Data For Traveler Preference 2    V2,A:1234    #tp_version=V2
    # AP Data With V2
    Generate Test Variables And Data For Agency Preferences    ap_version=V2.2    ap_carrier_code=AC    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=1    row_id=1    ap_version_override=true
    Generate Test Variables And Data For Agency Preferences    ap_version=V2.2    ap_carrier_code=AD    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=2    row_id=2    ap_version_override=true
    # CP Data With V2
    Generate Test Variables And Data For Client Preferences    cp_version=V2    cp_csu_guid=A:1234    cp_carrier_code=BC    cp_origin=A_JFK    cp_destination=A_LHR    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_version=V2    cp_csu_guid=A:1234    cp_carrier_code=BD    cp_origin=A_JFK    cp_destination=CI_LON    cp_policy_order=2
    # Boost Data With V1
    Generate Test Variables And Data For Boost    boost_cp=0.4    boost_ap=0.3    boost_version=V1
    # Request For V1
    Create Test Data For Metadata    api_version=v1    ap_version=v1    cp_version=v2    tp_version=v1    boost_version=v2
    Generate Test Data For Traveler Preference 2    V1,A:1234
    # AP Data With V1
    Generate Test Variables And Data For Agency Preferences    ap_version=V1    ap_carrier_code=AA    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=1    row_id=1    ap_version_override=true
    Generate Test Variables And Data For Agency Preferences    ap_version=V1    ap_carrier_code=AB    ap_iss_country=C_US    ap_origin=A_JFK    ap_destination=A_LHR    ap_score=0.1
    ...    ap_policy_order=2    row_id=2    ap_version_override=true
    # CP Data With V1
    Generate Test Variables And Data For Client Preferences    cp_version=V1    cp_csu_guid=A:1234    cp_carrier_code=BA    cp_origin=A_JFK    cp_destination=A_LHR    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_version=V1    cp_csu_guid=A:1234    cp_carrier_code=BB    cp_origin=A_JFK    cp_destination=CI_LON    cp_policy_order=2
    # Boost Data With V2
    Generate Test Variables And Data For Boost    api_version=v1    boost_cp=0.4    boost_ap=0.3    boost_version=V1
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_083_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_083_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_083_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_083_v3_results.json

FNC_098 Score Is Successfully Retrieved When Origin-Destination Code Type Is City And Partial Match For Personalization(Only cpScore For V2 and V2.2)
    [Documentation]    Scenario : If one Airport to Airport is off within city. Then it should be behave off for all other airports within city for version V2 and V2.2
    ...
    ...    >> Retrieve CpScore For V2 and V2.2
    ...
    ...    >> Retrive both apScore and cpScore for V1
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    .*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::OKO::.*?::.*?::CEF::.*?::OFF|.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::HND::.*?::.*?::.*?::.*?::ON|.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::CEF::.*?::ON|.*?::.*?::.*?::.*?::.*?::.*?::.*?::.*?::NRT::.*?::.*?::ZSF::.*?::OFF
    Generate Test Data For Features    api_version_feature=v2    app_id=MyCWT_Mobile    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    csu_guid=C:1234    iss_country=JP    origin=TYO    destination=SFY    dep_date=20181212    app_id=MyCWT_Mobile
    ...    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile    group=A    ap_version=v1    cp_version=v1
    Create Test Data For Metadata    app_id=MyCWT_Mobile    group=DEFAULT    ap_version=v1    cp_version=v1
    # Multiple Matching AP Data
    Generate Test Data For Agency Preferences From File    file=FNC_098_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_098_cp_data.csv
    # Multiple Matching CP Data
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.7    boost_cp=0.4
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_098_v1_results.json    True
    Verify The Personalization Score When Version Is V2    FNC_098_v2_results.json    True
    Verify The Personalization Score When Version Is V2.2    FNC_098_v2.2_results.json    True
    Verify The Personalization Score When Version Is V3    FNC_098_v3_results.json    True

FNC_100 Verify Correct Response When Personalization And CP PassThrough Are ON And Varying Values For experimentGroupTypeCode, Control Group And Default Group
    [Tags]    V2    V2.2    V3
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    CONFIG::FEATURE::*
    Delete All Redis Keys Using Pattern    ALGORITHM::*
    Delete All Redis Keys Using Pattern    RULES*
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Log    Different experimentGroupTypeCode And Control And Default Group Exists
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=A    ap_version=v1    cp_version=v1    ap_version_override=true
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=B    ap_version=v1    cp_version=v1    ap_version_override=true
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=DEFAULT    ap_version=v2.2    cp_version=v2    ap_version_override=true
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    # Multiple Matching AP Data
    Generate Test Variables And Data For Agency Preferences    ap_version=V1    ap_carrier_code=AA    ap_iss_country=R_ASA    ap_origin=A_MNL    ap_destination=A_NRT    ap_score=0.3
    ...    ap_policy_order=1    ap_version_override=true
    Generate Test Variables And Data For Agency Preferences    ap_version=V2.2    ap_carrier_code=BA    ap_iss_country=R_ASA    ap_origin=A_MNL    ap_destination=A_NRT    ap_score=0.6
    ...    ap_policy_order=1    ap_version_override=true
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_version=V1    cp_csu_guid=B:4567    cp_carrier_code=AA    cp_origin=A_MNL    cp_destination=A_NRT    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_version=V2    cp_csu_guid=B:4567    cp_carrier_code=BA    cp_origin=A_MNL    cp_destination=A_NRT    cp_policy_order=1
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=Desktop_Amadeus    boost_ap=0.7    boost_cp=1
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_A_control_default_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_A_control_default_grp_exist).json
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_B_control_default_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_B_control_default_grp_exist).json
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_X_control_default_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_X_control_default_grp_exist).json
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_None_control_default_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_None_control_default_grp_exist).json
    ##experimentGroupTypeCode Empty
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_Empty_control_default_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_Empty_control_default_grp_exist).json
    Log    Different experimentGroupTypeCode And Control Group Type Does Not Exist And Default Group Exists
    Delete All Redis Keys Using Pattern    ALGORITHM::A::DESKTOP_AMADEUS::V2
    Delete All Redis Keys Using Pattern    ALGORITHM::A::DESKTOP_AMADEUS::V2.2
    Delete All Redis Keys Using Pattern    ALGORITHM::A::DESKTOP_AMADEUS::V3
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=D:1234    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_A_with_default_grp_exist).json    # Check Trv Guid
    Verify The Personalization Score When Version Is V2.2    FNC_100_v2.2_results(prefix_A_with_default_grp_exist).json
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_A_with_default_grp_exist).json
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT    dep_date=20181208
    ...    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_B_with_default_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_B_with_default_grp_exist).json
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=D:1234    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_X_with_default_grp_exist).json
    Verify The Personalization Score When Version Is V2.2    FNC_100_v2.2_results(prefix_X_with_default_grp_exist).json
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_X_with_default_grp_exist).json
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=D:1234    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_None_with_default_grp_exist).json
    Verify The Personalization Score When Version Is V2.2    FNC_100_v2.2_results(prefix_None_with_default_grp_exist).json
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_None_with_default_grp_exist).json
    ##experimentGroupTypeCode Empty
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=D:1234    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_Empty_with_default_grp_exist).json
    Verify The Personalization Score When Version Is V2.2    FNC_100_v2.2_results(prefix_Empty_with_default_grp_exist).json
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_Empty_with_default_grp_exist).json
    Log    Different experimentGroupTypeCode And Control Group Type And Default Group Does Not Exists
    Delete All Redis Keys Using Pattern    ALGORITHM::DEFAULT::DESKTOP_AMADEUS::V2
    Delete All Redis Keys Using Pattern    ALGORITHM::A::DESKTOP_AMADEUS::V2.2
    Delete All Redis Keys Using Pattern    ALGORITHM::DEFAULT::DESKTOP_AMADEUS::V2.2
    Delete All Redis Keys Using Pattern    ALGORITHM::DEFAULT::DESKTOP_AMADEUS::V3
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4019    error_message=No data available for experiment type code in request, control and default groups
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_B_algorithm_B_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_B_algorithm_B_exist).json
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4019    error_message=No data available for experiment type code in request, control and default groups
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4019    error_message=No data available for experiment type code in request, control and default groups
    ##experimentGroupTypeCode Empty
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4019    error_message=No data available for experiment type code in request, control and default groups
    Log    Different experimentGroupTypeCode And Control Group Type Exist And Default Group Does Not Exist
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=A    ap_version=v1    cp_version=v1    ap_version_override=true
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_A_control_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_A_control_grp_exist).json
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_B_control_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_B_control_grp_exist).json
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_X_control_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_X_control_grp_exist).json
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_None_control_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_None_control_grp_exist).json
    ##experimentGroupTypeCode Empty
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_100_v2_results(prefix_Empty_control_grp_exist).json
    Verify Error Message When Version Is V2.2    error_status=500    error_code=500    error_message=Air API has encountered an error.
    Verify The Personalization Score When Version Is V3    FNC_100_v3_results(prefix_Empty_control_grp_exist).json

FNC_101 Verify Correct Response When Personalization Is OFF And CP PassThrough Are ON And Varying Values For experimentGroupTypeCode, Control Group And Default Group
    [Tags]    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Add Rules In Redis    ${personalization_off}
    Generate Test Data For Features    app_id=Desktop_Amadeus    oag_value=false    cp_pass=true    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Log    Different experimentGroupTypeCode And Control And Default Group Exists
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=A    ap_version=v1    cp_version=v1    ap_version_override=true
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=B    ap_version=v1    cp_version=v1    ap_version_override=true
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=DEFAULT    ap_version=v2.2    cp_version=v2    ap_version_override=true
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    # Multiple Matching AP Data
    Generate Test Variables And Data For Agency Preferences    ap_version=V1    ap_carrier_code=AA    ap_iss_country=R_ASA    ap_origin=A_MNL    ap_destination=A_NRT    ap_score=0.3
    ...    ap_policy_order=1    ap_version_override=true
    Generate Test Variables And Data For Agency Preferences    ap_version=V2.2    ap_carrier_code=BA    ap_iss_country=R_ASA    ap_origin=A_MNL    ap_destination=A_NRT    ap_score=0.6
    ...    ap_policy_order=1    ap_version_override=true
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_version=V1    cp_csu_guid=B:4567    cp_carrier_code=AA    cp_origin=A_MNL    cp_destination=A_NRT    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_version=V2    cp_csu_guid=B:4567    cp_carrier_code=BA    cp_origin=A_MNL    cp_destination=A_NRT    cp_policy_order=1
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=Desktop_Amadeus    boost_ap=0.7    boost_cp=1
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results.json
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_B).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_B).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_B).json
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_X).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_X).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_X).json
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_None).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_None).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_None).json
    ##experimentGroupTypeCode Empty
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_empty).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_empty).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_empty).json
    Log    Different experimentGroupTypeCode And Control Group Type Does Not Exist And Default Group Exists
    Delete All Redis Keys Using Pattern    ALGORITHM::A::DESKTOP_AMADEUS::V2
    Delete All Redis Keys Using Pattern    ALGORITHM::A::DESKTOP_AMADEUS::V2.2
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_A_with_default_grp).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_A_with_default_grp).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_A_with_default_grp).json
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_B_with_default_grp).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_B_with_default_grp).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_B_with_default_grp).json
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_X_with_default_grp).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_X_with_default_grp).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_X_with_default_grp).json
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_None_with_default_grp).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_None_with_default_grp).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_None_with_default_grp).json
    ##experimentGroupTypeCode Empty
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V2    FNC_101_v2_results(prefix_Empty_with_default_grp).json
    Verify The Personalization Score When Version Is V2.2    FNC_101_v2.2_results(prefix_Empty_with_default_grp).json
    Verify The Personalization Score When Version Is V3    FNC_101_v3_results(prefix_Empty_with_default_grp).json
    Log    Different experimentGroupTypeCode And Control Group Type And Default Group Does Not Exists
    Delete All Redis Keys Using Pattern    ALGORITHM::DEFAULT::DESKTOP_AMADEUS::V2
    Delete All Redis Keys Using Pattern    ALGORITHM::DEFAULT::DESKTOP_AMADEUS::V2.2
    Delete All Redis Keys Using Pattern    ALGORITHM::DEFAULT::DESKTOP_AMADEUS::V3
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    Log    Different experimentGroupTypeCode And Control Group Type Exist And Default Group Does Not Exist
    Create Test Data For Metadata    app_id=Desktop_Amadeus    group=A    ap_version=v1    cp_version=v1
    ##experimentGroupTypeCode A
    Generate Test Variables For Personalization Score    prefix=A    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode B
    Generate Test Variables For Personalization Score    prefix=B    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode X
    Generate Test Variables For Personalization Score    prefix=X    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode None
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found
    ##experimentGroupTypeCode Empty
    Generate Test Variables For Personalization Score    prefix=${EMPTY}    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=Desktop_Amadeus
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    400
    Verify That Error Response Is Returned    error_code=4017    error_message=Project Algorithm not found

FNC_102 Error Response When Personalization_OFF, CP_Pass_OFF, experimentGroupTypeCode_A, Default And Control Group Is Available
    [Tags]    V2    V2.2    V3
    [Setup]    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Delete All Redis Keys Using Pattern    CONFIG::FEATURE::*
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Add Rules In Redis    ${personalization_off}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    prefix=None    trv_guid=S:0986    csu_guid=B:4567    iss_country=PH    origin=MNL    destination=NRT
    ...    dep_date=20181208    app_id=MyCWT_Mobile
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile    group=A    ap_version=v1    cp_version=v1
    Create Test Data For Metadata    app_id=MyCWT_Mobile    group=DEFAULT    ap_version=v2.2    cp_version=v2
    # Multiple Matching AP Data
    Generate Test Variables And Data For Agency Preferences    ap_version=V1    ap_carrier_code=AA    ap_iss_country=R_ASA    ap_origin=A_MNL    ap_destination=A_NRT    ap_score=0.3
    ...    ap_policy_order=1    ap_version_override=true
    Generate Test Variables And Data For Agency Preferences    ap_version=V2.2    ap_carrier_code=BA    ap_iss_country=R_ASA    ap_origin=A_MNL    ap_destination=A_NRT    ap_score=0.6
    ...    ap_policy_order=1    ap_version_override=true
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_version=V1    cp_csu_guid=B:4567    cp_carrier_code=AA    cp_origin=A_MNL    cp_destination=A_NRT    cp_policy_order=1
    Generate Test Variables And Data For Client Preferences    cp_version=V2    cp_csu_guid=B:4567    cp_carrier_code=BA    cp_origin=A_MNL    cp_destination=A_NRT    cp_policy_order=1
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.7    boost_cp=1
    Send Personalization Score Request
    Verify That Response Status Code Is Correct    403
    Verify That Error Response Is Returned    error_code=4004    error_message=Personalization is turned OFF for this request.

FNC_103 Score Is Successfully Retrieved With Same Carrier Code And Same Policy Order And Direction Type Is Bidirectional
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Clear Cache    personalizationConfig
    Get Authorization Token
    Generate Test Variables For Personalization Score    csu_guid=A:1234    iss_country=SG    origin=NRT    destination=OKO    dep_date=20181202
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching AP Data With Origin Country
    Generate Test Data For Agency Preferences From File    file=FNC_103_ap_data.csv
    #Matching Client Data
    Generate Test Data For Client Preferences From File    file=FNC_103_cp_data.csv
    #Matching Boost
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.3    boost_cp=0.7
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_103_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_103_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_103_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_103_v3_results.json

FNC_107 Score Is Successfully Retrieved With Multiple Distinct Sets (MC,CC,VC)
    [Documentation]    *Request* \ -- Airport To Airport
    ...
    ...    *For V2.2* \ -- Add one more filter by booking date
    ...
    ...    *Scenario:*
    ...    -- Multiple AP Distinct Matches For Each Cabin Class
    ...    -- Multiple CP Distinct Macthes with hierarchy and different Policy Order For Each Carrier Code
    ...
    ...    For V1 and V2 Requests-- Same as before
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Features    app_id=MyCWT_Mobile    oag_value=false    cp_pass=false    default_tp=false
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Get Authorization Token
    Generate Test Variables For Personalization Score    csu_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20190101    booking_date=20180712
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching AP Data With Origin Airport
    Generate Test Data For Agency Preferences From File    file=FNC_107_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_107_cp_data.csv
    #Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_107_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_107_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_107_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_107_v3_results.json

FNC_108 Score Is Successfully Retrieved When Duplicate Data Exists Per Distinct Sets (MC,CC,VC)
    [Documentation]    *Request* -- Airport To Airport
    ...
    ...    *Scenario:*
    ...    -- Multiple AP Duplicates Matches For Each Cabin Class
    ...    -- Multiple CP Duplicates Matches with hierarchy and different/same Policy Order For Each Carrier Code
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Get Authorization Token
    Generate Test Variables For Personalization Score    csu_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20190912    booking_date=20180712
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching CP Data
    Generate Test Data For Agency Preferences From File    file=FNC_108_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Data For Client Preferences From File    file=FNC_108_cp_data.csv
    #Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_108_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_108_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_108_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_108_v3_results.json

FNC_109 Score Is Succesfully Retrieved With Multiple Distinct Sets Where Origin-Destination Code Type Is City (MC,CC,VC)
    [Documentation]    *Request* \ -- City To City
    ...
    ...    *Scenario*
    ...    -- Multiple Unique and Duplicates AP Data For Each Cabin Class
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Get Authorization Token
    Generate Test Variables For Personalization Score    csu_guid=C:1234    iss_country=US    origin=TYO    destination=SFY    dep_date=20181212    app_id=MyCWT_Mobile
    ...    origin_code_type=C    destination_code_type=C
    Create TP Meta Data
    Create Test Data For Metadata    app_id=MyCWT_Mobile
    #Agent Data
    Generate Test Data For Agency Preferences From File    file=FNC_109_ap_data.csv
    # Multiple Matching CP Data
    Generate Test Variables And Data For Client Preferences    cp_csu_guid=C:1234    cp_carrier_code=AA    cp_origin=CI_TYO    cp_destination=A_CEF    cp_score=0.4    cp_policy_order=1
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_app_id=MyCWT_Mobile    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_109_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_109_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_109_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_109_v3_results.json

FNC_110 No Score Is Returned When bookingDate Is Not Matched
    [Documentation]    *Request* -- Airport To Airport (With NON Matching Booking Date Only For V2.2)
    ...
    ...    *Scenario*
    ...    -- Multiple AP distinct and unique data
    ...
    ...    -- NON Matching AP Data for V2.2
    ...
    ...    -- Multiple Matching Data for V1 and V2
    [Tags]    V1    V2    V2.2    V3
    Delete All Versions Redis Keys
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Generate Test Variables For Personalization Score    trv_guid=D:1234    csu_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20190912
    ...    booking_date=20170712
    Create TP Meta Data
    Create Test Data For Metadata
    # AP Data
    Generate Test Data For Agency Preferences From File    file=FNC_110_ap_data.csv
    # Single Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_110_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_110_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_110_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_110_v3_results.json

FNC_111 Score Is Successfully Retrieved With Multiple Distinct Sets With Different Versions Of AP Files(V1 and V2.2)
    [Documentation]    *Request* \ -- Airport To Airport
    ...
    ...    *For V2.2* \ -- Add one more filter by booking date
    ...
    ...    *Scenario:*
    ...    -- Multiple AP Distinct Matches For Each Cabin Class
    ...    -- Multiple CP Distinct Macthes with hierarchy and different Policy Order For Each Carrier Code
    ...
    ...    For V1 and V2 Requests-- Same as before
    [Tags]    V1    V2    V2.2    V3
    Delete All Redis Keys Using Pattern    RULES*
    Delete All Versions Redis Keys
    Add Rules In Redis    ${all_match}
    Generate Test Data For Traveler Preference 2    V1,S:0986
    Generate Test Data For Traveler Preference 2    V1,D:1234
    Get Authorization Token
    Generate Test Variables For Get Personalization Score When Version Is V1    trv_guid=S:0986    csu_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20190101
    ...    app_id=MyCWT_Mobile
    Generate Test Variables For Get Personalization Score When Version Is V2    trv_guid=S:0986    csu_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20190101
    ...    app_id=MyCWT_Mobile
    Generate Test Variables For Get Personalization Score When Version Is V2.2    trv_guid=S:0986    csu_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20190101
    ...    booking_date=20180712    app_id=MyCWT_Mobile
    Generate Test Variables For Post Personalization Score When Version Is V3    trv_guid=S:0986    csu_guid=A:1234    iss_country=US    origin=JFK    destination=LHR    dep_date=20190101
    ...    booking_date=20180712    app_id=MyCWT_Mobile
    Create TP Meta Data
    Create Test Data For Metadata
    # Multiple Matching AP Data With Origin Airport
    Generate Test Data For Agency Preferences From File    file=FNC_111_ap_data(v1).csv    ap_version_override=true    ap_version=V1
    # Multiple Matching CP Data
    Generate Test Data For Agency Preferences From File    file=FNC_111_ap_data(v2.2).csv    ap_version_override=true    ap_version=V2.2
    #Matching Boost Data
    Generate Test Variables And Data For Boost    boost_ap=0.3    boost_cp=0.3
    Send Personalization Score Request
    Verify That Correct Status Code Are Returned    200
    Verify That Response Headers Are Correct
    Verify The Personalization Score When Version Is V1    FNC_111_v1_results.json
    Verify The Personalization Score When Version Is V2    FNC_111_v2_results.json
    Verify The Personalization Score When Version Is V2.2    FNC_111_v2.2_results.json
    Verify The Personalization Score When Version Is V3    FNC_111_v3_results.json
